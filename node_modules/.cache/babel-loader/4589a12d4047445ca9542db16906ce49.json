{"ast":null,"code":"import _classCallCheck from\"/Users/sebastianmolano/NebulaE/Projects/GTPC/dicon-audit-pwa/frontend/dicon-audit-pwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/sebastianmolano/NebulaE/Projects/GTPC/dicon-audit-pwa/frontend/dicon-audit-pwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/sebastianmolano/NebulaE/Projects/GTPC/dicon-audit-pwa/frontend/dicon-audit-pwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/sebastianmolano/NebulaE/Projects/GTPC/dicon-audit-pwa/frontend/dicon-audit-pwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import FuseUtils from'@fuse/utils/FuseUtils';import axios from'axios';import jwtDecode from'jwt-decode';/* eslint-disable camelcase */var JwtService=/*#__PURE__*/function(_FuseUtils$EventEmitt){_inherits(JwtService,_FuseUtils$EventEmitt);var _super=_createSuper(JwtService);function JwtService(){var _this;_classCallCheck(this,JwtService);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.setInterceptors=function(){axios.interceptors.response.use(function(response){return response;},function(err){return new Promise(function(resolve,reject){if(err.response.status===401&&err.config&&!err.config.__isRetryRequest){// if you ever get an unauthorized response, logout the user\n_this.emit('onAutoLogout','Invalid access_token');_this.setSession(null);}throw err;});});};_this.handleAuthentication=function(){var access_token=_this.getAccessToken();if(!access_token){_this.emit('onNoAccessToken');return;}if(_this.isAuthTokenValid(access_token)){_this.setSession(access_token);_this.emit('onAutoLogin',true);}else{_this.setSession(null);_this.emit('onAutoLogout','access_token expired');}};_this.createUser=function(data){return new Promise(function(resolve,reject){axios.post('/api/auth/register',data).then(function(response){if(response.data.user){_this.setSession(response.data.access_token);resolve(response.data.user);}else{reject(response.data.error);}});});};_this.signInWithEmailAndPassword=function(email,password){return new Promise(function(resolve,reject){axios.get('/api/auth',{data:{email:email,password:password}}).then(function(response){if(response.data.user){_this.setSession(response.data.access_token);resolve(response.data.user);}else{reject(response.data.error);}});});};_this.signInWithToken=function(){return new Promise(function(resolve,reject){axios.get('/api/auth/access-token',{data:{access_token:_this.getAccessToken()}}).then(function(response){if(response.data.user){_this.setSession(response.data.access_token);resolve(response.data.user);}else{_this.logout();reject(new Error('Failed to login with token.'));}}).catch(function(error){_this.logout();reject(new Error('Failed to login with token.'));});});};_this.updateUserData=function(user){return axios.post('/api/auth/user/update',{user:user});};_this.setSession=function(access_token){if(access_token){localStorage.setItem('jwt_access_token',access_token);axios.defaults.headers.common.Authorization=\"Bearer \".concat(access_token);}else{localStorage.removeItem('jwt_access_token');delete axios.defaults.headers.common.Authorization;}};_this.logout=function(){_this.setSession(null);};_this.isAuthTokenValid=function(access_token){if(!access_token){return false;}var decoded=jwtDecode(access_token);var currentTime=Date.now()/1000;if(decoded.exp<currentTime){console.warn('access token expired');return false;}return true;};_this.getAccessToken=function(){return window.localStorage.getItem('jwt_access_token');};return _this;}_createClass(JwtService,[{key:\"init\",value:function init(){this.setInterceptors();this.handleAuthentication();}}]);return JwtService;}(FuseUtils.EventEmitter);var instance=new JwtService();export default instance;","map":null,"metadata":{},"sourceType":"module"}