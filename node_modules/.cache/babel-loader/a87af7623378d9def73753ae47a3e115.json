{"ast":null,"code":"import _objectSpread from\"/Users/sebastianmolano/NebulaE/Projects/GTPC/dicon-audit-pwa/frontend/dicon-audit-pwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/Users/sebastianmolano/NebulaE/Projects/GTPC/dicon-audit-pwa/frontend/dicon-audit-pwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/sebastianmolano/NebulaE/Projects/GTPC/dicon-audit-pwa/frontend/dicon-audit-pwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";/* eslint import/no-extraneous-dependencies: off */import{createSlice}from'@reduxjs/toolkit';import firebase from'firebase/compat/app';import'firebase/compat/auth';import history from'@history';import _ from'@lodash';import{setInitialSettings,setDefaultSettings}from'app/store/fuse/settingsSlice';import{showMessage}from'app/store/fuse/messageSlice';import auth0Service from'app/services/auth0Service';import firebaseService from'app/services/firebaseService';import jwtService from'app/services/jwtService';export var setUserDataAuth0=function setUserDataAuth0(tokenData){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var user;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:user={role:['admin'],from:'auth0',data:{displayName:tokenData.username||tokenData.name,photoURL:tokenData.picture,email:tokenData.email,settings:tokenData.user_metadata&&tokenData.user_metadata.settings?tokenData.user_metadata.settings:{},shortcuts:tokenData.user_metadata&&tokenData.user_metadata.shortcuts?tokenData.user_metadata.shortcuts:[]}};return _context.abrupt(\"return\",dispatch(setUserData(user)));case 2:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();};export var setUserDataFirebase=function setUserDataFirebase(user,authUser){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(user&&user.data&&user.data.settings&&user.data.settings.theme&&user.data.settings.layout&&user.data.settings.layout.style)){_context2.next=2;break;}return _context2.abrupt(\"return\",dispatch(setUserData(user)));case 2:return _context2.abrupt(\"return\",dispatch(createUserSettingsFirebase(authUser)));case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}();};export var createUserSettingsFirebase=function createUserSettingsFirebase(authUser){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch,getState){var guestUser,fuseDefaultSettings,_firebase$auth,currentUser,user;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:guestUser=getState().auth.user;fuseDefaultSettings=getState().fuse.settings.defaults;_firebase$auth=firebase.auth(),currentUser=_firebase$auth.currentUser;/**\n   * Merge with current Settings\n   */user=_.merge({},guestUser,{uid:authUser.uid,from:'firebase',role:['admin'],data:{displayName:authUser.displayName,email:authUser.email,settings:_objectSpread({},fuseDefaultSettings)}});currentUser.updateProfile(user.data);dispatch(updateUserData(user));return _context3.abrupt(\"return\",dispatch(setUserData(user)));case 7:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x3,_x4){return _ref3.apply(this,arguments);};}();};export var setUserData=function setUserData(user){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch,getState){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:/*\n        You can redirect the logged-in user to a specific route depending on his role\n         */history.location.state={redirectUrl:user.redirectUrl// for example 'apps/academy'\n};/*\n    Set User Settings\n     */dispatch(setDefaultSettings(user.data.settings));dispatch(setUser(user));case 3:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x5,_x6){return _ref4.apply(this,arguments);};}();};export var updateUserSettings=function updateUserSettings(settings){return/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(dispatch,getState){var oldUser,user;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:oldUser=getState().auth.user;user=_.merge({},oldUser,{data:{settings:settings}});dispatch(updateUserData(user));return _context5.abrupt(\"return\",dispatch(setUserData(user)));case 4:case\"end\":return _context5.stop();}}},_callee5);}));return function(_x7,_x8){return _ref5.apply(this,arguments);};}();};export var updateUserShortcuts=function updateUserShortcuts(shortcuts){return/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(dispatch,getState){var user,newUser;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:user=getState().auth.user;newUser=_objectSpread(_objectSpread({},user),{},{data:_objectSpread(_objectSpread({},user.data),{},{shortcuts:shortcuts})});dispatch(updateUserData(newUser));return _context6.abrupt(\"return\",dispatch(setUserData(newUser)));case 4:case\"end\":return _context6.stop();}}},_callee6);}));return function(_x9,_x10){return _ref6.apply(this,arguments);};}();};export var logoutUser=function logoutUser(){return/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(dispatch,getState){var user;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:user=getState().auth.user;if(!(!user.role||user.role.length===0)){_context7.next=3;break;}return _context7.abrupt(\"return\",null);case 3:history.push({pathname:'/'});_context7.t0=user.from;_context7.next=_context7.t0==='firebase'?7:_context7.t0==='auth0'?9:11;break;case 7:firebaseService.signOut();return _context7.abrupt(\"break\",12);case 9:auth0Service.logout();return _context7.abrupt(\"break\",12);case 11:jwtService.logout();case 12:dispatch(setInitialSettings());return _context7.abrupt(\"return\",dispatch(userLoggedOut()));case 14:case\"end\":return _context7.stop();}}},_callee7);}));return function(_x11,_x12){return _ref7.apply(this,arguments);};}();};export var updateUserData=function updateUserData(user){return/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(dispatch,getState){return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:if(!(!user.role||user.role.length===0)){_context8.next=2;break;}return _context8.abrupt(\"return\");case 2:_context8.t0=user.from;_context8.next=_context8.t0==='firebase'?5:_context8.t0==='auth0'?7:9;break;case 5:firebaseService.updateUserData(user).then(function(){dispatch(showMessage({message:'User data saved to firebase'}));}).catch(function(error){dispatch(showMessage({message:error.message}));});return _context8.abrupt(\"break\",11);case 7:auth0Service.updateUserData({settings:user.data.settings,shortcuts:user.data.shortcuts}).then(function(){dispatch(showMessage({message:'User data saved to auth0'}));}).catch(function(error){dispatch(showMessage({message:error.message}));});return _context8.abrupt(\"break\",11);case 9:jwtService.updateUserData(user).then(function(){dispatch(showMessage({message:'User data saved with api'}));}).catch(function(error){dispatch(showMessage({message:error.message}));});return _context8.abrupt(\"break\",11);case 11:case\"end\":return _context8.stop();}}},_callee8);}));return function(_x13,_x14){return _ref8.apply(this,arguments);};}();};var initialState={role:[],// guest\ndata:{displayName:'GTPC',photoURL:'assets/images/logos/logo-area-metropolitana.png',email:'Auditor√≠a v1.7.6-beta',shortcuts:['calendar','mail','contacts','todo']}};var userSlice=createSlice({name:'auth/user',initialState:initialState,reducers:{setUser:function setUser(state,action){return action.payload;},userLoggedOut:function userLoggedOut(state,action){return initialState;}},extraReducers:{}});var _userSlice$actions=userSlice.actions,setUser=_userSlice$actions.setUser,userLoggedOut=_userSlice$actions.userLoggedOut;export{setUser,userLoggedOut};export default userSlice.reducer;","map":null,"metadata":{},"sourceType":"module"}