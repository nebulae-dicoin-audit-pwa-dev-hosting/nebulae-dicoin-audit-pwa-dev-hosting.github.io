{"ast":null,"code":"import _slicedToArray from\"/Users/sebastianmolano/NebulaE/Projects/GTPC/dicon-audit-pwa/frontend/dicon-audit-pwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useContext,useEffect,useState}from'react';import{useTranslation}from'react-i18next';import moment from'moment';import{Button,Dialog,DialogActions,DialogContent,DialogTitle,Typography,Icon}from'@mui/material';import{makeStyles}from'@mui/styles';import AnalysisContext from'../Analysis-context/AnalysisContext';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var useStyles=makeStyles({});export default function DialogStatistics(props){var open=props.open,handleClose=props.handleClose;var _useContext=useContext(AnalysisContext),appFileContent=_useContext.appFileContent;var _useTranslation=useTranslation('analysisPage'),t=_useTranslation.t;var classes=useStyles();function getRecordAttemptsLatencyAverage(record){var attepms=record.stats.attempts||[];var attempsLength=attepms.length;var latencyTotal=attepms.reduce(function(acc,val){return acc+(val.latency||0);},0);return latencyTotal&&attempsLength?latencyTotal/attempsLength:0;}function getRecordAttemptsLatencySum(record){var attepms=record.stats.attempts||[];if(attepms.length===0)return'--';var latencyTotal=attepms.reduce(function(acc,val){return acc+(val.latency||0);},0);return latencyTotal;}var _useState=useState({totalRecord:0,totalLatency:0,pending:0,retrying:0,sent:0,error:0,frontDoorInput:0,backDoorInput:0,frontDoorOutput:0,backDoorOutput:0,timestamp:0,endTimestamp:0,taveledTime:0}),_useState2=_slicedToArray(_useState,2),recordSummary=_useState2[0],setRecordSummary=_useState2[1];useEffect(function(){if(appFileContent){var recordsSummary=appFileContent.reduce(function(acc,record){if(record.type==='RECORD'){console.log(record);acc.totalLatency+=getRecordAttemptsLatencyAverage(record);acc.totalRecord+=1;if(record.state==='PERSISTED')acc.pending+=1;if(record.state==='SENDING')acc.retrying+=1;if(record.state==='SENT')acc.sent+=1;if(record.state==='ERROR')acc.error+=1;acc.frontDoorInput+=record.payload.frontDoorInput;acc.backDoorInput+=record.payload.backDoorInput;acc.frontDoorOutput+=record.payload.frontDoorOutput;acc.backDoorOutput+=record.payload.backDoorOutput;if(!acc.timestamp)acc.timestamp=record.timestamp;console.log('record.tripState',record.tripState.endTimestamp);if(record.tripState.endTimestamp)acc.endTimestamp+=record.tripState.endTimestamp;if(record.tripState.endTimestamp){acc.taveledTime=record.tripState.endTimestamp-acc.timestamp;}else{acc.taveledTime=record.timestamp-acc.timestamp;}}return acc;},{totalRecord:0,totalLatency:0,pending:0,retrying:0,sent:0,error:0,frontDoorInput:0,backDoorInput:0,frontDoorOutput:0,backDoorOutput:0,timestamp:0,endTimestamp:0,taveledTime:0});setRecordSummary(recordsSummary);}},[appFileContent]);function msToTime(duration){var seconds=Math.floor(duration/1000%60);var minutes=Math.floor(duration/(1000*60)%60);var hours=Math.floor(duration/(1000*60*60)%24);return\"\".concat(hours<9?\"0\".concat(hours):hours,\":\").concat(minutes<9?\"0\".concat(minutes):minutes,\":\").concat(seconds<9?\"0\".concat(seconds):seconds);}return/*#__PURE__*/_jsxs(Dialog,{open:open,onClose:handleClose,\"aria-labelledby\":\"alert-dialog-title\",\"aria-describedby\":\"alert-dialog-description\",children:[/*#__PURE__*/_jsx(DialogTitle,{id:\"alert-dialog-title\",children:t('ANALYSIS_DIALOG_STATISTICS_TITLE')}),/*#__PURE__*/_jsxs(DialogContent,{dividers:true,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start\",children:[/*#__PURE__*/_jsx(Icon,{className:\"mr-10\",children:\"sync_alt\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Typography,{children:[recordSummary.sent<9?\"0\".concat(recordSummary.sent):recordSummary.sent,\"/\",recordSummary.totalRecord<9?\"0\".concat(recordSummary.totalRecord):recordSummary.totalRecord,\",\",t('TRAVEL_DIALOG_STATISTICS_PENDING_EVENTS'),\": \",/*#__PURE__*/_jsx(\"b\",{children:recordSummary.pending}),\",\",t('TRAVEL_DIALOG_STATISTICS_RETRANSMISSION_ATTEMPT'),\":\",' ',/*#__PURE__*/_jsx(\"b\",{children:recordSummary.retrying}),\",\",t('TRAVEL_DIALOG_STATISTICS_TRANSMISSION_ERRORS'),\":\",/*#__PURE__*/_jsx(\"b\",{children:recordSummary.error})]}),/*#__PURE__*/_jsxs(Typography,{children:[t('TRAVEL_DIALOG_STATISTICS_TRANSMISSION_LATENCY'),\":\",' ',/*#__PURE__*/_jsx(\"b\",{children:recordSummary.totalLatency/recordSummary.totalRecord>0?\"\".concat(parseInt(recordSummary.totalLatency/recordSummary.totalRecord,10),\"milisegundos\"):'--'})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start mt-10\",children:[/*#__PURE__*/_jsx(Icon,{className:\"mr-10\",children:\"people_alt\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Typography,{children:[t('TRAVEL_DIALOG_STATISTICS_INCOME'),\":\",' ',/*#__PURE__*/_jsxs(\"b\",{children:[recordSummary.frontDoorInput+recordSummary.backDoorInput,\", \"]}),t('TRAVEL_DIALOG_STATISTICS_DEPARTURES'),\":\",' ',/*#__PURE__*/_jsx(\"b\",{children:recordSummary.frontDoorOutput+recordSummary.backDoorOutput})]}),/*#__PURE__*/_jsxs(Typography,{children:[t('TRAVEL_DIALOG_STATISTICS_PASSENGERS_IN_BUS'),\":\",' ',/*#__PURE__*/_jsx(\"b\",{children:recordSummary.frontDoorInput+recordSummary.backDoorInput-(recordSummary.frontDoorOutput+recordSummary.backDoorOutput)})]}),/*#__PURE__*/_jsxs(Typography,{children:[t('TRAVEL_DIALOG_STATISTICS_FRONT_DOOR'),\":\",' ',/*#__PURE__*/_jsxs(\"b\",{children:[\"+\",recordSummary.frontDoorInput,\" -\",recordSummary.frontDoorOutput]})]}),/*#__PURE__*/_jsxs(Typography,{children:[t('TRAVEL_DIALOG_STATISTICS_BACK_DOOR'),\":\",' ',/*#__PURE__*/_jsxs(\"b\",{children:[\"+\",recordSummary.backDoorInput,\" -\",recordSummary.backDoorOutput]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start mt-10\",children:[/*#__PURE__*/_jsx(Icon,{className:\"mr-10\",children:\"access_time\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Typography,{children:[t('TRAVEL_DIALOG_STATISTICS_LAPSE_OF_TIME'),\":\",' ',/*#__PURE__*/_jsxs(\"b\",{children:[\" \",msToTime(recordSummary.taveledTime)]})]}),/*#__PURE__*/_jsxs(Typography,{children:[t('TRAVEL_DIALOG_STATISTICS_START'),\":\",' ',/*#__PURE__*/_jsxs(\"b\",{children:[\" \",moment(recordSummary.timestamp).format('DD/MM/YYYY HH:mm:ss')]})]}),/*#__PURE__*/_jsxs(Typography,{children:[t('TRAVEL_DIALOG_STATISTICS_END'),\":\",' ',/*#__PURE__*/_jsx(\"b\",{children:recordSummary.endTimestamp?moment(recordSummary.endTimestamp).format('DD/MM/YYYY HH:mm:ss'):'--/--/--- --:--:--'})]})]})]})]}),/*#__PURE__*/_jsx(DialogActions,{children:/*#__PURE__*/_jsx(Button,{onClick:handleClose,variant:\"contained\",color:\"error\",children:t('ANALYSIS_DIALOG_STATISTICS_CLOSE')})})]});}","map":null,"metadata":{},"sourceType":"module"}