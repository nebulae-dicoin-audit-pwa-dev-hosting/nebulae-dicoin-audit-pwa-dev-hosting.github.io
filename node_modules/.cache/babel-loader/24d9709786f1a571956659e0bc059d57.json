{"ast":null,"code":"var _jsxFileName = \"/Users/sebastianmolano/NebulaE/Projects/GTPC/dicon-audit-pwa/frontend/dicon-audit-pwa/src/app/main/travels/Travels.js\";\nimport { useState, useEffect, useRef } from 'react';\nimport FusePageSimple from '@fuse/core/FusePageSimple';\nimport { useSnackbar } from 'notistack';\nimport { useTranslation } from 'react-i18next';\nimport { useSelector } from 'react-redux';\nimport { useEventCallback } from 'rxjs-hooks';\nimport { tap, concatMap } from 'rxjs/operators';\nimport { of } from 'rxjs';\nimport _ from '@lodash';\nimport { styled } from '@mui/material/styles';\nimport { Hidden, Button, Icon, Typography, CircularProgress } from '@mui/material';\nimport { makeStyles } from '@mui/styles';\nimport * as FileSaver from 'file-saver';\nimport TravelContext from './travel-context/TravelContext';\nimport useGeolocation from './tools/useGeolocation/GeoLocation';\nimport NavbarToggleButton from '../../fuse-layouts/shared-components/NavbarToggleButton';\nimport TableExecution from './contentExecution/TableExecution';\nimport { Dicoin, Trip, RecordGenerationRules, TransmissionConfig, EVENT_TYPES } from './tools/dicoin-engine';\nimport DialogCreateExecution from './dialogs/DialogCreateExecution';\nimport DialogAddNote from './dialogs/DialogAddNote';\nimport DialogFinalize from './dialogs/DialogFinalize';\nimport DialogStatistics from './dialogs/DialogStatistics';\nimport DialogRecordDetail from './dialogs/DialogRecordDetail';\nimport DialogDownload from './dialogs/DialogDownload';\nimport DialogConfirm from './dialogs/DialogConfirm';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst Root = styled(FusePageSimple)({\n  '& .FusePageSimple-header': {\n    height: 'auto',\n    minHeight: 'auto'\n  },\n  '& .FusePageSimple-toolbar': {},\n  '& .FusePageSimple-content': {},\n  '& .FusePageSimple-sidebarHeader': {},\n  '& .FusePageSimple-sidebarContent': {}\n});\nconst useStyles = makeStyles({\n  TransformRotate: {\n    transform: 'rotate(-90deg)'\n  },\n  btnHeaderWhite: {\n    padding: '6px',\n    background: 'white',\n    minWidth: 'auto',\n    color: '#202937'\n  },\n  btnHeader: {\n    padding: '6px',\n    minWidth: 'auto',\n    color: 'white'\n  },\n  contenTable: {\n    height: 'calc(100vh - 93px)',\n    // height: 'calc(100vh - 150px)',\n    background: 'white',\n    '& > div': {\n      display: 'flex',\n      flexWrap: 'wrap',\n      height: '100%',\n      placeContent: 'start',\n      '& > div:nth-child(2)': {\n        transition: 'all 0.5s ease'\n      }\n    }\n  },\n  noHover: {\n    '&:hover': {\n      backgroundColor: 'white'\n    }\n  },\n  btnSilver: {\n    background: '#808080'\n  },\n  textother: {\n    fontSize: '0.6rem'\n  }\n});\nconst rowHeight = 29;\n\nfunction TravelsPage(props) {\n  const {\n    t\n  } = useTranslation('travelsPage');\n  const [availableHeight, setAvailableHeight] = useState(window.innerHeight - 210);\n  const {\n    enqueueSnackbar\n  } = useSnackbar();\n  const configFuse = useSelector(_ref => {\n    let {\n      fuse\n    } = _ref;\n    return fuse.settings.current.layout.config;\n  });\n  const navbar = useSelector(_ref2 => {\n    let {\n      fuse\n    } = _ref2;\n    return fuse.navbar;\n  });\n  const classes = useStyles();\n  const [dataDialogNewExecution, setDataDialogNewExecution] = useState({\n    onLine: false\n  });\n  const [initialized, setInitialized] = useState(false);\n  const [open, setOpen] = useState(false);\n  const [applierCallBack, applier] = useEventCallback(event$ => event$.pipe(concatMap(s => of(s).pipe(tap(_ref3 => {\n    let {\n      applierSource,\n      action\n    } = _ref3;\n    console.log('applierSource', applierSource);\n    action();\n  })))));\n\n  const handleClickOpen = () => {\n    setOpen(true);\n  };\n\n  const handleClose = () => {\n    setOpen(false);\n  }; // #region cardDragAnimateBtn\n\n\n  const [openCard, setOpenCard] = useState(false);\n  const [displayBtnDisabled, setDisplayBtnDisabled] = useState(false);\n  const [progressLoading, setProgressLoading] = useState(false);\n  const cards = ['top', 'bottom'];\n\n  function hadleOpenBtnDrag() {\n    setOpenCard(false);\n    setProgressLoading(true);\n    setAvailableHeight(window.innerHeight - 536);\n    setTimeout(() => {\n      setOpenCard(true);\n      setDisplayBtnDisabled(false);\n    }, 500);\n  }\n\n  function hadleCloseBtnDrag() {\n    setOpenCard(false);\n  }\n\n  useEffect(() => {\n    if (displayBtnDisabled) {\n      const btn = document.getElementById('myBtnHeaderCards');\n\n      if (btn) {\n        btn.blur();\n      }\n    }\n  }, [displayBtnDisabled]); //  #endregion\n  //  #region device orientation\n\n  const [orientation, setOrientation] = useState('portrait');\n  const [isMobile, setIsMobile] = useState(true); //  #endregion\n  //  #region keyboard detected\n\n  const [keyboardDetected, setKeyboardDetected] = useState(false);\n  const [focusInput, setFocusInput] = useState(null);\n\n  function onKeyboardOnOff(isOpen) {\n    // Write down your handling code\n    if (isOpen) {\n      setKeyboardDetected(true);\n    } else {\n      setKeyboardDetected(false);\n    }\n  }\n\n  let originalPotion = false;\n\n  window.onload = function () {\n    if (originalPotion === false) originalPotion = window.innerWidth + window.innerHeight;\n  };\n  /**\n   * Determine the mobile operating system.\n   * This function returns one of 'iOS', 'Android', 'Windows Phone', or 'unknown'.\n   *\n   * @returns {String}\n   */\n\n\n  function getMobileOperatingSystem() {\n    const userAgent = navigator.userAgent || navigator.vendor || window.opera; // Windows Phone must come first because its UA also contains \"Android\"\n\n    if (/windows phone/i.test(userAgent)) {\n      return 'winphone';\n    }\n\n    if (/android/i.test(userAgent)) {\n      return 'android';\n    } // iOS detection from: http://stackoverflow.com/a/9039885/177710\n\n\n    if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {\n      return 'ios';\n    }\n\n    return '';\n  }\n\n  function applyAfterResize() {\n    if (getMobileOperatingSystem() !== 'ios') {\n      if (originalPotion !== false) {\n        const wasWithKeyboard = document.querySelector('body').classList.contains('view-withKeyboard');\n        let nowWithKeyboard = false;\n        const diff = Math.abs(originalPotion - (document.querySelector(window).width() + document.querySelector(window).height()));\n        if (diff > 100) nowWithKeyboard = true;\n        document.querySelector('body').classList.toggle('view-withKeyboard', nowWithKeyboard);\n\n        if (wasWithKeyboard !== nowWithKeyboard) {\n          onKeyboardOnOff(nowWithKeyboard);\n        }\n      }\n    }\n  }\n\n  const itemsEvents = ['select', 'textarea', 'input'];\n  itemsEvents.forEach(item => {\n    const items = document.getElementsByTagName(`${item}`);\n    Array.from(items).forEach((i, index) => {\n      if (i.name) {\n        document.querySelector(`${item}[name=${i.id}]`).addEventListener('focus', function (e) {\n          const nowWithKeyboard = e.type === 'focus';\n          document.querySelector('body').classList.toggle('view-withKeyboard', nowWithKeyboard);\n          onKeyboardOnOff(nowWithKeyboard);\n          const node = document.getElementById(`${i.id}`);\n          node.select();\n          setFocusInput(i.id);\n        });\n        document.querySelector(`${item}[name=${i.id}]`).addEventListener('blur', function (e) {\n          const nowWithKeyboard = e.type === 'focus';\n          document.querySelector('body').classList.toggle('view-withKeyboard', nowWithKeyboard);\n          onKeyboardOnOff(nowWithKeyboard);\n          setFocusInput(null);\n        });\n      }\n    });\n  });\n  document.querySelector('html').addEventListener('resize', function () {\n    if (!open) {\n      applyAfterResize();\n    }\n  });\n  document.querySelector('html').addEventListener('orientationchange', function () {\n    if (!open) {\n      applyAfterResize();\n    }\n  }); //  #endregion\n  //  #region time btns\n\n  const period = 250;\n  const [timeSecondsTop, setTimeSecondsTop] = useState(0);\n  const [timeSecondsBot, setTimeSecondsBot] = useState(0);\n  const timeTop = useRef();\n  const timeBot = useRef();\n  useEffect(() => {\n    const topFocus = (focusInput || '').match('top');\n\n    if (timeSecondsTop >= 0 && openCard) {\n      let value = timeSecondsTop;\n\n      if (timeTop.current) {\n        window.clearInterval(timeTop.current);\n        clearInterval(timeTop.current);\n      }\n\n      if (topFocus === null) {\n        timeTop.current = setInterval(() => {\n          value += period;\n          setTimeSecondsTop(value);\n        }, period);\n      } else {\n        setTimeSecondsTop(0);\n      }\n\n      const accumulatorTimeThreshold = dicoin.recordGenerationRules ? dicoin.recordGenerationRules.accumulatorTimeThreshold : 2000;\n\n      if (timeSecondsTop >= accumulatorTimeThreshold) {\n        window.clearInterval(timeTop.current);\n        clearInterval(timeTop.current);\n      }\n    }\n  }, [timeSecondsTop, openCard, focusInput]);\n  useEffect(() => {\n    const botFocus = (focusInput || '').match('bot');\n\n    if (timeSecondsBot >= 0 && openCard) {\n      let value = timeSecondsBot;\n\n      if (timeBot.current) {\n        window.clearInterval(timeBot.current);\n        clearInterval(timeBot.current);\n      }\n\n      if (botFocus === null) {\n        timeBot.current = setInterval(() => {\n          value += period;\n          setTimeSecondsBot(value);\n        }, period);\n      } else {\n        setTimeSecondsBot(0);\n      }\n\n      const accumulatorTimeThreshold = dicoin.recordGenerationRules ? dicoin.recordGenerationRules.accumulatorTimeThreshold : 2000;\n\n      if (timeSecondsBot >= accumulatorTimeThreshold) {\n        window.clearInterval(timeBot.current);\n        clearInterval(timeBot.current);\n      }\n    }\n  }, [timeSecondsBot, openCard, focusInput]); // #endregion\n  //  #region btn count passengers\n\n  const [topDoor, setTopDoor] = useState({\n    entry: 0,\n    exit: 0\n  });\n  const [botDoor, setBotDoor] = useState({\n    entry: 0,\n    exit: 0\n  });\n\n  function handleAddCountDoorEntry(type, event) {\n    window.navigator.vibrate(80);\n    const data = event && parseInt(event.target.value, 10) || 0;\n\n    if (type === 'top') {\n      setTimeSecondsTop(0);\n      setTopDoor({ ...topDoor,\n        entry: event ? data : topDoor.entry + 1\n      });\n    } else {\n      setTimeSecondsBot(0);\n      setBotDoor({ ...botDoor,\n        entry: event ? data : botDoor.entry + 1\n      });\n    }\n  }\n\n  function handleAddCountDoorExit(type, event) {\n    window.navigator.vibrate(80);\n    const data = event && parseInt(event.target.value, 10) || 0;\n\n    if (type === 'top') {\n      setTimeSecondsTop(0);\n      setTopDoor({ ...topDoor,\n        exit: event ? data : topDoor.exit + 1\n      });\n    } else {\n      setTimeSecondsBot(0);\n      setBotDoor({ ...botDoor,\n        exit: event ? data : botDoor.exit + 1\n      });\n    }\n  } //  #endregion\n  //  #region dialog statistics\n\n\n  const [openDialogStatistics, setOpenDialogStatistics] = useState(false);\n\n  function handleOpenDialogStatistics() {\n    setOpenDialogStatistics(true);\n  }\n\n  function handleCloseDialogStatistics() {\n    setOpenDialogStatistics(false);\n  } //  #endregion\n  //  #region dialog statistics\n\n\n  const [openDialogRecordDetails, setOpenDialogRecordDetails] = useState(false);\n  const [dataDialogDetails, setDataDialogDetails] = useState();\n\n  function handleOpenDialogRecordDetails(data) {\n    setOpenDialogRecordDetails(true);\n    setDataDialogDetails(data);\n  }\n\n  function handleCloseDialogRecordDetails() {\n    setOpenDialogRecordDetails(false);\n  } //  #endregion\n  //  #region Download\n\n\n  const [openDialogDownload, setOpenDialogDownload] = useState(false);\n\n  function handleOpenDialogDownload() {\n    setOpenDialogDownload(true);\n  }\n\n  function handleCloseDialogDownload() {\n    setOpenDialogDownload(false);\n  } //  #endregion\n  // #region Engine\n\n  /**\n   * @type [Dicoin,function]\n   */\n\n\n  const [dicoin, setDicoin] = useState(() => new Dicoin());\n  const [events, setEvents] = useState([]);\n  const [tripReported, setTripReported] = useState(false);\n  const [records, setRecords] = useState([]);\n  const [tripTempState, setTripTempState] = useState({});\n  const [tripState, setTripState] = useState({});\n  const [tripType, setTripType] = useState(false);\n  const [didDBStart, setDidDBStart] = useState(false);\n  const geolocation = useGeolocation({\n    enableHighAccuracy: true,\n    maximumAge: 1500,\n    timeout: 13000\n  }, () => {});\n  const [stateDoor, setStateDoor] = useState({\n    top: false,\n    bot: false\n  });\n  const [loading, setLoading] = useState(false);\n\n  function handleDialogNewExecution(dataDialogNewExecutionToCreate) {\n    localStorage.setItem('infoCreationExecution', JSON.stringify({\n      routeCode: dataDialogNewExecutionToCreate.routeCode,\n      route: dataDialogNewExecutionToCreate.route,\n      plate: dataDialogNewExecutionToCreate.plate,\n      driverLicense: dataDialogNewExecutionToCreate.driverLicense,\n      nitCompany: dataDialogNewExecutionToCreate.nitCompany,\n      onLine: dataDialogNewExecutionToCreate.onLine\n    }));\n    const transmisionConfigData = localStorage.getItem('transmissionConfig') ? JSON.parse(localStorage.getItem('transmissionConfig')) : null;\n    const recordGenerationRulesData = localStorage.getItem('recordGenerationRules') ? JSON.parse(localStorage.getItem('recordGenerationRules')) : null;\n\n    if (!transmisionConfigData || !recordGenerationRulesData) {\n      enqueueSnackbar(t('INVALID_PARAMS'), {\n        variant: 'error'\n      });\n    } else {\n      const trip = new Trip(dataDialogNewExecutionToCreate.routeCode, dataDialogNewExecutionToCreate.route, dataDialogNewExecutionToCreate.plate, dataDialogNewExecutionToCreate.driverLicense, dataDialogNewExecutionToCreate.nitCompany, dicoin.tripErrorReporter.bind(dicoin));\n      setTripType(dataDialogNewExecutionToCreate.onLine);\n      const transmissionConfig = new TransmissionConfig(dataDialogNewExecutionToCreate.onLine, transmisionConfigData.url, transmisionConfigData.user, transmisionConfigData.password, parseInt(transmisionConfigData.maxRetires, 10), parseInt(transmisionConfigData.delayBetweenRetries, 10), dicoin.tripErrorReporter.bind(dicoin));\n      const withRouteRules = recordGenerationRulesData.withRoute;\n      const recordGenerationRules = new RecordGenerationRules(parseInt(withRouteRules.distanceThreshold, 10), parseInt(withRouteRules.timeThreshold, 10) * 1000, parseInt(withRouteRules.speedThreshold, 10), withRouteRules.useDoorStateAsTrigger, recordGenerationRulesData.accumulatorTimeThreshold, dicoin.tripErrorReporter.bind(dicoin));\n      dicoin.startTrip(trip, transmissionConfig, recordGenerationRules);\n    }\n  }\n\n  useEffect(() => {\n    window.addEventListener('resize', () => {\n      setAvailableHeight(window.innerHeight - 210);\n    });\n    const dataLocal = JSON.parse(localStorage.getItem('infoCreationExecution'));\n\n    if (dataLocal) {\n      setDataDialogNewExecution({ ...dataDialogNewExecution,\n        ...dataLocal\n      });\n    }\n\n    dicoin.addListener('TRAVEL', event => {\n      switch (event.type) {\n        case EVENT_TYPES.TRIP_REPORT_GENERATED:\n          const {\n            reportContent,\n            fileName\n          } = event.payload;\n          setLoading(false);\n          FileSaver.saveAs(reportContent, fileName);\n          break;\n\n        case EVENT_TYPES.ERROR_REPORTED:\n          enqueueSnackbar(t(event.payload.message), {\n            variant: 'error'\n          });\n          break;\n\n        case EVENT_TYPES.TRIP_REPORTED:\n          enqueueSnackbar('Reportado Correctamente', {\n            variant: 'success'\n          });\n          setTripReported(true);\n          break;\n\n        case EVENT_TYPES.TRIP_STARTED:\n          setTripState(event.payload.state);\n          setTripTempState(event.payload.tempState || {});\n          setOpen(false);\n          setInitialized(true);\n          break;\n\n        case EVENT_TYPES.TRIP_LOADED:\n          if (event.payload.tripState === 'FINALIZED') {\n            setStateRoute(event.payload.reason);\n            setOpenDialogFinalize(false);\n            setInitialized(false);\n          } else {\n            setInitialized(true);\n          }\n\n          setTripState(event.payload.state || {});\n          setTripTempState(event.payload.tempState || {});\n          break;\n\n        case EVENT_TYPES.TRIP_STATE_CHANGED:\n          setTripState(event.payload.state || {});\n          setTripTempState(event.payload.tempState || {});\n          break;\n\n        case EVENT_TYPES.TRIP_STOPPED:\n          setTripState(event.payload.state || {});\n          setTripTempState(event.payload.tempState || {});\n          break;\n\n        case EVENT_TYPES.RECORD_GENERATED:\n          const newRecordsGenerated = _.cloneDeep(event.payload.records);\n\n          setRecords(newRecordsGenerated);\n          break;\n\n        case EVENT_TYPES.RECORD_UPDATED:\n          const newRecordsUpdated = _.cloneDeep(event.payload.records);\n\n          setRecords(newRecordsUpdated);\n          break;\n\n        case EVENT_TYPES.NOTE_ADDED:\n          const newRecordsAndNotesGenerated = _.cloneDeep(event.payload.records);\n\n          setRecords(newRecordsAndNotesGenerated);\n          break;\n\n        case EVENT_TYPES.TRIP_TYPE_REPORTED:\n          setTripType(event.payload.online);\n          break;\n\n        case EVENT_TYPES.TRIP_REMOVED:\n          setTripState({});\n          setTripTempState({});\n          setRecords([]);\n          setInitialized(false);\n          setStateRoute(null);\n          break;\n\n        case EVENT_TYPES.DB_STARTED:\n          setDidDBStart(true);\n          break;\n\n        default:\n          console.log('UNPROCESSED EVENT', event.type);\n          break;\n      }\n\n      events.push(event);\n      setEvents([...events]);\n    });\n    return () => {\n      dicoin.removeListener('TRAVEL');\n      dicoin.stopTrip('ABORTED_BY_USER_SECCION', true);\n    };\n  }, []);\n  useEffect(() => {\n    if (didDBStart) {\n      dicoin.recoverPersistedState();\n    }\n  }, [didDBStart]);\n  useEffect(() => {\n    if (!geolocation.error && geolocation && didDBStart) {\n      if (initialized) {\n        dicoin.reportGeolocationPosition(geolocation);\n      }\n    }\n  }, [geolocation, geolocation.error, initialized, didDBStart]);\n\n  function generateReport() {\n    setLoading(true);\n    dicoin.generateContentReport();\n  }\n\n  function handleDoor(type) {\n    const doorState = { ...stateDoor,\n      [type]: !stateDoor[type]\n    };\n    setStateDoor(doorState);\n  } // #endregion\n  //  #region dialogNote\n\n\n  const [openDialogNote, setOpenDialogNote] = useState(false);\n\n  function handleOpenDialogNote() {\n    setOpenDialogNote(true);\n  }\n\n  function handleCloseDialogNote() {\n    setOpenDialogNote(false);\n  }\n\n  function handleAddNote(note) {\n    setOpenDialogNote(false);\n    dicoin.addNote(note);\n  } //  #endregion\n  //  #region stateBtnDoors\n\n\n  const [stateCountTopDoor, setStateCountTopDoor] = useState({\n    entry: 0,\n    exit: 0\n  });\n  const [stateCountBotDoor, setStateCountBotDoor] = useState({\n    entry: 0,\n    exit: 0\n  });\n  useEffect(() => {\n    const accumulatorTimeThreshold = dicoin.recordGenerationRules ? dicoin.recordGenerationRules.accumulatorTimeThreshold : 2000;\n\n    if (timeSecondsTop >= accumulatorTimeThreshold && topDoor) {\n      const action = () => {\n        setStateCountTopDoor({ ...stateCountTopDoor,\n          entry: stateCountTopDoor.entry + topDoor.entry,\n          exit: stateCountTopDoor.exit + topDoor.exit\n        });\n        dicoin.reportPassengerFlow((topDoor || {}).entry || 0, (topDoor || {}).exit || 0, 0, 0);\n        setTimeout(() => {\n          setTopDoor({\n            entry: 0,\n            exit: 0\n          });\n        }, 500);\n      };\n\n      applierCallBack({\n        applierSource: 'timeSecondsTop',\n        action\n      });\n    }\n  }, [timeSecondsTop]);\n  useEffect(() => {\n    const accumulatorTimeThreshold = dicoin.recordGenerationRules ? dicoin.recordGenerationRules.accumulatorTimeThreshold : 2000;\n\n    if (timeSecondsBot >= accumulatorTimeThreshold && botDoor) {\n      const action = () => {\n        setStateCountBotDoor({ ...stateCountBotDoor,\n          entry: stateCountBotDoor.entry + botDoor.entry,\n          exit: stateCountBotDoor.exit + botDoor.exit\n        });\n        dicoin.reportPassengerFlow(0, 0, (botDoor || {}).entry || 0, (botDoor || {}).exit || 0);\n        setTimeout(() => {\n          setBotDoor({\n            entry: 0,\n            exit: 0\n          });\n        }, 500);\n      };\n\n      applierCallBack({\n        applierSource: 'timeSecondsBot',\n        action\n      });\n    }\n  }, [timeSecondsBot]);\n  useEffect(() => {\n    if (initialized) {\n      const action = () => {\n        if (botDoor) {\n          setStateCountBotDoor({ ...stateCountBotDoor,\n            entry: stateCountBotDoor.entry + botDoor.entry,\n            exit: stateCountBotDoor.exit + botDoor.exit\n          });\n          dicoin.reportPassengerFlow(0, 0, (botDoor || {}).entry || 0, (botDoor || {}).exit || 0);\n          setTimeout(() => {\n            setBotDoor({\n              entry: 0,\n              exit: 0\n            });\n          }, 500);\n        }\n\n        if (topDoor) {\n          setStateCountTopDoor({ ...stateCountTopDoor,\n            entry: stateCountTopDoor.entry + topDoor.entry,\n            exit: stateCountTopDoor.exit + topDoor.exit\n          });\n          dicoin.reportPassengerFlow((topDoor || {}).entry || 0, (topDoor || {}).exit || 0, 0, 0);\n          setTimeout(() => {\n            setTopDoor({\n              entry: 0,\n              exit: 0\n            });\n          }, 500);\n        }\n\n        setTimeSecondsTop(11);\n        setTimeSecondsBot(11);\n      };\n\n      applierCallBack({\n        applierSource: 'timeSecondsBot',\n        action\n      });\n      dicoin.reportDoorsStatus(stateDoor.top, stateDoor.bot);\n    }\n  }, [stateDoor]); //  #endregion\n  // #region Dialgo Confirm remove\n\n  const [openDialogConfirm, setOpenDialogConfirm] = useState(false);\n\n  function handleOpenDialogConfirm() {\n    setOpenDialogConfirm(true);\n  }\n\n  function handleCloseDialogConfirm() {\n    setOpenDialogConfirm(false);\n  }\n\n  function handleComfirmRemoveTrip() {\n    setOpenDialogConfirm(false);\n    dicoin.clearTrip();\n  } // #endregion\n  //  #region dialg finalize\n\n\n  const [openDialogFinalize, setOpenDialogFinalize] = useState(false);\n  const [stateRoute, setStateRoute] = useState(null);\n\n  function handleOpenDialogFinalize() {\n    if (dicoin.trip.route === 'NA') {\n      setStateRoute('NA');\n      setOpenDialogFinalize(false);\n      setInitialized(false);\n      setOpenCard(false);\n      dicoin.stopTrip('NA', true, true);\n    } else {\n      setOpenDialogFinalize(true);\n    }\n  }\n\n  function handleCloseDialogFinalize() {\n    setOpenDialogFinalize(false);\n  }\n\n  function hadleStateRoute(state) {\n    setStateRoute(state);\n    setOpenDialogFinalize(false);\n    setInitialized(false);\n    setOpenCard(false);\n    dicoin.stopTrip(state, true, true);\n  } //  #endregion\n\n\n  function handleReportTrip() {\n    dicoin.reportTripState();\n  }\n\n  function getLatLngasString() {\n    const {\n      latitude,\n      longitude\n    } = ((tripTempState || {}).geolocationPosition || {}).coords || {};\n\n    if (latitude == null || longitude == null || latitude === undefined || longitude === undefined) {\n      return '---,---';\n    }\n\n    console.log('=== toFixed getLatLngasString', latitude, longitude, latitude.toFixed, longitude.toFixed);\n    return `${latitude.toFixed(5)},${longitude.toFixed(5)}`;\n  }\n\n  function getSpeedAsString() {\n    const {\n      speed\n    } = ((tripTempState || {}).geolocationPosition || {}).coords || {};\n    if (speed === null || speed === undefined) return '-- km/h';\n    console.log('=== toFixed getSpeedAsString', speed, speed.toFixed);\n    return `${speed.toFixed(0)} km/h`;\n  }\n\n  function getDopAsString() {\n    const {\n      dop\n    } = ((tripTempState || {}).geolocationPosition || {}).coords || {};\n    if (dop === null || dop === undefined) return '--';\n    console.log('=== toFixed getDopAsString', dop, dop.toFixed);\n    return `${dop.toFixed ? dop.toFixed(1) : dop}`;\n  }\n\n  function getAccuaracyAsString() {\n    const {\n      accuracy\n    } = ((tripTempState || {}).geolocationPosition || {}).coords || {};\n    if (accuracy === null || accuracy === undefined) return '--';\n    console.log('=== toFixed getAccuaracyAsString', accuracy, accuracy.toFixed);\n    return `${accuracy.toFixed(0)}`;\n  }\n\n  function openMaps() {\n    if (!(((tripTempState || {}).geolocationPosition || {}).coords || {}).latitude) return;\n    const {\n      latitude,\n      longitude\n    } = tripTempState.geolocationPosition.coords;\n    window.open(`https://maps.google.com?q=${latitude},${longitude}`);\n  }\n\n  return /*#__PURE__*/_jsxDEV(TravelContext.Provider, {\n    value: {\n      hadleOpenBtnDrag,\n      hadleCloseBtnDrag,\n      setDisplayBtnDisabled,\n      handleAddCountDoorEntry,\n      handleAddCountDoorExit,\n      handleOpenDialogRecordDetails,\n      handleDoor,\n      setProgressLoading,\n      setAvailableHeight,\n      openCard,\n      displayBtnDisabled,\n      keyboardDetected,\n      cards,\n      topDoor,\n      botDoor,\n      stateCountTopDoor,\n      stateCountBotDoor,\n      timeSecondsTop,\n      timeSecondsBot,\n      stateDoor,\n      initialized,\n      stateRoute,\n      progressLoading,\n      records,\n      tripTempState,\n      tripState,\n      dicoin,\n      availableHeight,\n      rowHeight\n    },\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      children: orientation === 'portrait' && isMobile || orientation === 'landscape' && !isMobile ? /*#__PURE__*/_jsxDEV(Root, {\n        header: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"w-full flex flex-wrap place-content-start\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"w-full py-10 px-16 flex items-start justify-between\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              children: [configFuse.navbar.display && configFuse.navbar.position === 'left' && /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: [/*#__PURE__*/_jsxDEV(Hidden, {\n                  lgDown: true,\n                  children: [(configFuse.navbar.style === 'style-3' || configFuse.navbar.style === 'style-3-dense') && /*#__PURE__*/_jsxDEV(NavbarToggleButton, {\n                    className: \"w-40 h-40 p-0 mx-0\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 816,\n                    columnNumber: 29\n                  }, this), configFuse.navbar.style === 'style-1' && !navbar.open && /*#__PURE__*/_jsxDEV(NavbarToggleButton, {\n                    className: \"w-40 h-40 p-0 mx-0\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 820,\n                    columnNumber: 29\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 813,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(Hidden, {\n                  lgUp: true,\n                  children: /*#__PURE__*/_jsxDEV(NavbarToggleButton, {\n                    className: \"w-40 h-40 p-0 mx-0 sm:mx-8\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 825,\n                    columnNumber: 27\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 824,\n                  columnNumber: 25\n                }, this)]\n              }, void 0, true), /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: [initialized && /*#__PURE__*/_jsxDEV(Button, {\n                  variant: \"contained\",\n                  className: `${classes.btnHeaderWhite} mr-5`,\n                  onClick: () => {\n                    handleOpenDialogNote();\n                  },\n                  children: /*#__PURE__*/_jsxDEV(Icon, {\n                    children: \"note_add\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 839,\n                    columnNumber: 27\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 832,\n                  columnNumber: 25\n                }, this), (initialized && stateRoute === null || !initialized && stateRoute !== null) && /*#__PURE__*/_jsxDEV(Button, {\n                  variant: \"contained\",\n                  className: `${classes.btnHeaderWhite} mr-5`,\n                  onClick: () => {\n                    handleOpenDialogStatistics();\n                  },\n                  children: /*#__PURE__*/_jsxDEV(Icon, {\n                    children: \"show_chart\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 851,\n                    columnNumber: 27\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 844,\n                  columnNumber: 25\n                }, this), initialized && /*#__PURE__*/_jsxDEV(Button, {\n                  id: \"myBtnHeaderCards213\",\n                  variant: \"contained\",\n                  className: `${classes.btnHeaderWhite} ${displayBtnDisabled && classes.noHover}`,\n                  disabled: progressLoading || !displayBtnDisabled && openCard,\n                  onClick: evt => {\n                    evt.stopPropagation();\n                    hadleOpenBtnDrag();\n                  },\n                  children: progressLoading ? /*#__PURE__*/_jsxDEV(CircularProgress, {\n                    size: 25\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 867,\n                    columnNumber: 46\n                  }, this) : /*#__PURE__*/_jsxDEV(Icon, {\n                    children: \"adjust\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 867,\n                    columnNumber: 79\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 855,\n                  columnNumber: 25\n                }, this), !initialized && stateRoute !== null && /*#__PURE__*/_jsxDEV(Button, {\n                  variant: \"contained\",\n                  className: `${classes.btnHeader} mr-5`,\n                  color: \"error\",\n                  onClick: () => {\n                    handleOpenDialogConfirm();\n                  },\n                  children: /*#__PURE__*/_jsxDEV(Icon, {\n                    children: \"delete_forever\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 880,\n                    columnNumber: 27\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 872,\n                  columnNumber: 25\n                }, this), !initialized && stateRoute !== null && /*#__PURE__*/_jsxDEV(Button, {\n                  variant: \"contained\",\n                  className: `${classes.btnHeader} mr-5`,\n                  color: \"success\",\n                  disabled: tripReported || tripType,\n                  onClick: () => {\n                    handleReportTrip();\n                  },\n                  children: /*#__PURE__*/_jsxDEV(Icon, {\n                    children: \"publish\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 893,\n                    columnNumber: 27\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 884,\n                  columnNumber: 25\n                }, this)]\n              }, void 0, true)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 810,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [!initialized && stateRoute === null && /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"contained\",\n                color: \"success\",\n                onClick: () => {\n                  handleClickOpen();\n                },\n                children: [/*#__PURE__*/_jsxDEV(Icon, {\n                  children: \"flag\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 908,\n                  columnNumber: 25\n                }, this), t('TRAVEL_HEADER_START')]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 901,\n                columnNumber: 23\n              }, this), initialized && stateRoute === null && /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"contained\",\n                color: \"error\",\n                onClick: () => {\n                  handleOpenDialogFinalize();\n                },\n                children: [t('TRAVEL_HEADER_FINALIZE'), /*#__PURE__*/_jsxDEV(Icon, {\n                  children: \"flag\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 922,\n                  columnNumber: 25\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 914,\n                columnNumber: 23\n              }, this), !initialized && stateRoute !== null && /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"contained\",\n                className: `${classes.btnSilver}`,\n                onClick: evt => {\n                  evt.stopPropagation();\n                  generateReport();\n                },\n                children: [/*#__PURE__*/_jsxDEV(Icon, {\n                  children: \"assignment_returned\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 934,\n                  columnNumber: 25\n                }, this), t('TRAVEL_HEADER_DOWNLOAD')]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 926,\n                columnNumber: 23\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 899,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 809,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"w-full flex items-center pt-5 pb-10 px-16\",\n            children: [/*#__PURE__*/_jsxDEV(Typography, {\n              className: `text-xs mr-10 ${classes.textother}`,\n              onClick: openMaps,\n              children: [/*#__PURE__*/_jsxDEV(Icon, {\n                className: `${classes.TransformRotate} text-sm mr-5`,\n                children: \"send\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 943,\n                columnNumber: 21\n              }, this), getLatLngasString()]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 942,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(Typography, {\n              className: `text-xs mr-10 ${classes.textother}`,\n              onClick: openMaps,\n              children: [/*#__PURE__*/_jsxDEV(Icon, {\n                className: \"text-sm mr-5\",\n                children: \"av_timer\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 948,\n                columnNumber: 21\n              }, this), getSpeedAsString()]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 947,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(Typography, {\n              className: `text-xs mr-10 ${classes.textother}`,\n              onClick: openMaps,\n              children: [/*#__PURE__*/_jsxDEV(Icon, {\n                className: \"text-sm mr-5\",\n                children: \"satellite_alt\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 953,\n                columnNumber: 21\n              }, this), getDopAsString()]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 952,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(Typography, {\n              className: `text-xs mr-10 ${classes.textother}`,\n              onClick: openMaps,\n              children: [/*#__PURE__*/_jsxDEV(Icon, {\n                className: \"text-sm mr-5\",\n                children: \"radio_button_checked\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 958,\n                columnNumber: 21\n              }, this), getAccuaracyAsString()]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 957,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(Typography, {\n              className: `text-xs mr-10 ${classes.textother}`,\n              onClick: openMaps,\n              children: [/*#__PURE__*/_jsxDEV(Icon, {\n                className: \"text-sm mr-5\",\n                children: \"sync_alt\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 963,\n                columnNumber: 21\n              }, this), dataDialogNewExecution.onLine ? `${records.filter(r => r.state === 'SENT').length || '0'}/` : '', ' ', records.filter(r => r.type === 'RECORD').length || '0']\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 962,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 941,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 808,\n          columnNumber: 15\n        }, this),\n        content: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `${classes.contenTable} p-10`,\n          children: [/*#__PURE__*/_jsxDEV(TableExecution, {\n            accumulatorTimeThreshold: dicoin && dicoin.recordGenerationRules ? dicoin.recordGenerationRules.accumulatorTimeThreshold : 2000\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 974,\n            columnNumber: 17\n          }, this), open && /*#__PURE__*/_jsxDEV(DialogCreateExecution, {\n            open,\n            handleClose,\n            dataDialogNewExecution,\n            setDataDialogNewExecution,\n            handleDialogNewExecution\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 982,\n            columnNumber: 19\n          }, this), openDialogNote && /*#__PURE__*/_jsxDEV(DialogAddNote, {\n            open: openDialogNote,\n            handleClose: handleCloseDialogNote,\n            handleAddNote\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 993,\n            columnNumber: 19\n          }, this), openDialogFinalize && /*#__PURE__*/_jsxDEV(DialogFinalize, {\n            open: openDialogFinalize,\n            handleClose: handleCloseDialogFinalize,\n            hadleStateRoute\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 998,\n            columnNumber: 19\n          }, this), openDialogStatistics && /*#__PURE__*/_jsxDEV(DialogStatistics, {\n            open: openDialogStatistics,\n            handleClose: handleCloseDialogStatistics\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1007,\n            columnNumber: 19\n          }, this), openDialogRecordDetails && /*#__PURE__*/_jsxDEV(DialogRecordDetail, {\n            open: openDialogRecordDetails,\n            handleClose: handleCloseDialogRecordDetails,\n            record: dataDialogDetails\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1012,\n            columnNumber: 19\n          }, this), openDialogDownload && /*#__PURE__*/_jsxDEV(DialogDownload, {\n            open: openDialogDownload,\n            handleClose: handleCloseDialogDownload\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1021,\n            columnNumber: 19\n          }, this), openDialogConfirm && /*#__PURE__*/_jsxDEV(DialogConfirm, {\n            open: openDialogConfirm,\n            handleClose: handleCloseDialogConfirm,\n            handleAction: handleComfirmRemoveTrip\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1026,\n            columnNumber: 19\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 973,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 806,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(Root, {\n        header: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"w-full flex flex-wrap place-content-start\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"w-full py-10 px-16 flex items-center justify-center h-screen\",\n            children: /*#__PURE__*/_jsxDEV(Typography, {\n              className: \"text-center w-full text-sm\",\n              children: /*#__PURE__*/_jsxDEV(\"b\", {\n                children: t('TRAVEL_APPLICATION_ORIENTATION_ERROR_MESSAGE')\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1043,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1042,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1041,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1040,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1038,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 804,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 771,\n    columnNumber: 5\n  }, this);\n}\n\nexport default TravelsPage;","map":{"version":3,"sources":["/Users/sebastianmolano/NebulaE/Projects/GTPC/dicon-audit-pwa/frontend/dicon-audit-pwa/src/app/main/travels/Travels.js"],"names":["useState","useEffect","useRef","FusePageSimple","useSnackbar","useTranslation","useSelector","useEventCallback","tap","concatMap","of","_","styled","Hidden","Button","Icon","Typography","CircularProgress","makeStyles","FileSaver","TravelContext","useGeolocation","NavbarToggleButton","TableExecution","Dicoin","Trip","RecordGenerationRules","TransmissionConfig","EVENT_TYPES","DialogCreateExecution","DialogAddNote","DialogFinalize","DialogStatistics","DialogRecordDetail","DialogDownload","DialogConfirm","Root","height","minHeight","useStyles","TransformRotate","transform","btnHeaderWhite","padding","background","minWidth","color","btnHeader","contenTable","display","flexWrap","placeContent","transition","noHover","backgroundColor","btnSilver","textother","fontSize","rowHeight","TravelsPage","props","t","availableHeight","setAvailableHeight","window","innerHeight","enqueueSnackbar","configFuse","fuse","settings","current","layout","config","navbar","classes","dataDialogNewExecution","setDataDialogNewExecution","onLine","initialized","setInitialized","open","setOpen","applierCallBack","applier","event$","pipe","s","applierSource","action","console","log","handleClickOpen","handleClose","openCard","setOpenCard","displayBtnDisabled","setDisplayBtnDisabled","progressLoading","setProgressLoading","cards","hadleOpenBtnDrag","setTimeout","hadleCloseBtnDrag","btn","document","getElementById","blur","orientation","setOrientation","isMobile","setIsMobile","keyboardDetected","setKeyboardDetected","focusInput","setFocusInput","onKeyboardOnOff","isOpen","originalPotion","onload","innerWidth","getMobileOperatingSystem","userAgent","navigator","vendor","opera","test","MSStream","applyAfterResize","wasWithKeyboard","querySelector","classList","contains","nowWithKeyboard","diff","Math","abs","width","toggle","itemsEvents","forEach","item","items","getElementsByTagName","Array","from","i","index","name","id","addEventListener","e","type","node","select","period","timeSecondsTop","setTimeSecondsTop","timeSecondsBot","setTimeSecondsBot","timeTop","timeBot","topFocus","match","value","clearInterval","setInterval","accumulatorTimeThreshold","dicoin","recordGenerationRules","botFocus","topDoor","setTopDoor","entry","exit","botDoor","setBotDoor","handleAddCountDoorEntry","event","vibrate","data","parseInt","target","handleAddCountDoorExit","openDialogStatistics","setOpenDialogStatistics","handleOpenDialogStatistics","handleCloseDialogStatistics","openDialogRecordDetails","setOpenDialogRecordDetails","dataDialogDetails","setDataDialogDetails","handleOpenDialogRecordDetails","handleCloseDialogRecordDetails","openDialogDownload","setOpenDialogDownload","handleOpenDialogDownload","handleCloseDialogDownload","setDicoin","events","setEvents","tripReported","setTripReported","records","setRecords","tripTempState","setTripTempState","tripState","setTripState","tripType","setTripType","didDBStart","setDidDBStart","geolocation","enableHighAccuracy","maximumAge","timeout","stateDoor","setStateDoor","top","bot","loading","setLoading","handleDialogNewExecution","dataDialogNewExecutionToCreate","localStorage","setItem","JSON","stringify","routeCode","route","plate","driverLicense","nitCompany","transmisionConfigData","getItem","parse","recordGenerationRulesData","variant","trip","tripErrorReporter","bind","transmissionConfig","url","user","password","maxRetires","delayBetweenRetries","withRouteRules","withRoute","distanceThreshold","timeThreshold","speedThreshold","useDoorStateAsTrigger","startTrip","dataLocal","addListener","TRIP_REPORT_GENERATED","reportContent","fileName","payload","saveAs","ERROR_REPORTED","message","TRIP_REPORTED","TRIP_STARTED","state","tempState","TRIP_LOADED","setStateRoute","reason","setOpenDialogFinalize","TRIP_STATE_CHANGED","TRIP_STOPPED","RECORD_GENERATED","newRecordsGenerated","cloneDeep","RECORD_UPDATED","newRecordsUpdated","NOTE_ADDED","newRecordsAndNotesGenerated","TRIP_TYPE_REPORTED","online","TRIP_REMOVED","DB_STARTED","push","removeListener","stopTrip","recoverPersistedState","error","reportGeolocationPosition","generateReport","generateContentReport","handleDoor","doorState","openDialogNote","setOpenDialogNote","handleOpenDialogNote","handleCloseDialogNote","handleAddNote","note","addNote","stateCountTopDoor","setStateCountTopDoor","stateCountBotDoor","setStateCountBotDoor","reportPassengerFlow","reportDoorsStatus","openDialogConfirm","setOpenDialogConfirm","handleOpenDialogConfirm","handleCloseDialogConfirm","handleComfirmRemoveTrip","clearTrip","openDialogFinalize","stateRoute","handleOpenDialogFinalize","handleCloseDialogFinalize","hadleStateRoute","handleReportTrip","reportTripState","getLatLngasString","latitude","longitude","geolocationPosition","coords","undefined","toFixed","getSpeedAsString","speed","getDopAsString","dop","getAccuaracyAsString","accuracy","openMaps","position","style","evt","stopPropagation","filter","r","length","record","handleAction"],"mappings":"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","sourcesContent":["import { useState, useEffect, useRef } from 'react';\n\nimport FusePageSimple from '@fuse/core/FusePageSimple';\nimport { useSnackbar } from 'notistack';\nimport { useTranslation } from 'react-i18next';\nimport { useSelector } from 'react-redux';\nimport { useEventCallback } from 'rxjs-hooks';\nimport { tap, concatMap } from 'rxjs/operators';\nimport { of } from 'rxjs';\nimport _ from '@lodash';\nimport { styled } from '@mui/material/styles';\nimport { Hidden, Button, Icon, Typography, CircularProgress } from '@mui/material';\nimport { makeStyles } from '@mui/styles';\nimport * as FileSaver from 'file-saver';\nimport TravelContext from './travel-context/TravelContext';\nimport useGeolocation from './tools/useGeolocation/GeoLocation';\nimport NavbarToggleButton from '../../fuse-layouts/shared-components/NavbarToggleButton';\nimport TableExecution from './contentExecution/TableExecution';\nimport {\n  Dicoin,\n  Trip,\n  RecordGenerationRules,\n  TransmissionConfig,\n  EVENT_TYPES,\n} from './tools/dicoin-engine';\nimport DialogCreateExecution from './dialogs/DialogCreateExecution';\nimport DialogAddNote from './dialogs/DialogAddNote';\nimport DialogFinalize from './dialogs/DialogFinalize';\nimport DialogStatistics from './dialogs/DialogStatistics';\nimport DialogRecordDetail from './dialogs/DialogRecordDetail';\nimport DialogDownload from './dialogs/DialogDownload';\nimport DialogConfirm from './dialogs/DialogConfirm';\n\nconst Root = styled(FusePageSimple)({\n  '& .FusePageSimple-header': {\n    height: 'auto',\n    minHeight: 'auto',\n  },\n  '& .FusePageSimple-toolbar': {},\n  '& .FusePageSimple-content': {},\n  '& .FusePageSimple-sidebarHeader': {},\n  '& .FusePageSimple-sidebarContent': {},\n});\n\nconst useStyles = makeStyles({\n  TransformRotate: {\n    transform: 'rotate(-90deg)',\n  },\n  btnHeaderWhite: {\n    padding: '6px',\n    background: 'white',\n    minWidth: 'auto',\n    color: '#202937',\n  },\n  btnHeader: {\n    padding: '6px',\n    minWidth: 'auto',\n    color: 'white',\n  },\n  contenTable: {\n    height: 'calc(100vh - 93px)',\n    // height: 'calc(100vh - 150px)',\n    background: 'white',\n    '& > div': {\n      display: 'flex',\n      flexWrap: 'wrap',\n      height: '100%',\n      placeContent: 'start',\n      '& > div:nth-child(2)': {\n        transition: 'all 0.5s ease',\n      },\n    },\n  },\n  noHover: {\n    '&:hover': {\n      backgroundColor: 'white',\n    },\n  },\n  btnSilver: {\n    background: '#808080',\n  },\n  textother: {\n    fontSize: '0.6rem',\n  }\n});\n\nconst rowHeight = 29;\n\nfunction TravelsPage(props) {\n  const { t } = useTranslation('travelsPage');\n  const [availableHeight, setAvailableHeight] = useState(window.innerHeight - 210);\n  const { enqueueSnackbar } = useSnackbar();\n  const configFuse = useSelector(({ fuse }) => fuse.settings.current.layout.config);\n  const navbar = useSelector(({ fuse }) => fuse.navbar);\n  const classes = useStyles();\n  const [dataDialogNewExecution, setDataDialogNewExecution] = useState({ onLine: false });\n  const [initialized, setInitialized] = useState(false);\n  const [open, setOpen] = useState(false);\n\n  const [applierCallBack, applier] = useEventCallback((event$) =>\n    event$.pipe(\n      concatMap((s) =>\n        of(s).pipe(\n          tap(({ applierSource, action }) => {\n            console.log('applierSource', applierSource);\n            action();\n          })\n        )\n      )\n    )\n  );\n\n  const handleClickOpen = () => {\n    setOpen(true);\n  };\n\n  const handleClose = () => {\n    setOpen(false);\n  };\n\n  // #region cardDragAnimateBtn\n\n  const [openCard, setOpenCard] = useState(false);\n  const [displayBtnDisabled, setDisplayBtnDisabled] = useState(false);\n  const [progressLoading, setProgressLoading] = useState(false);\n  const cards = ['top', 'bottom'];\n\n  function hadleOpenBtnDrag() {\n    setOpenCard(false);\n    setProgressLoading(true);\n    setAvailableHeight(window.innerHeight - 536);\n    setTimeout(() => {\n      setOpenCard(true);\n      setDisplayBtnDisabled(false);\n    }, 500);\n  }\n\n  function hadleCloseBtnDrag() {\n    setOpenCard(false);\n  }\n\n  useEffect(() => {\n    if (displayBtnDisabled) {\n      const btn = document.getElementById('myBtnHeaderCards');\n      if (btn) {\n        btn.blur();\n      }\n    }\n  }, [displayBtnDisabled]);\n  //  #endregion\n\n  //  #region device orientation\n  const [orientation, setOrientation] = useState('portrait');\n  const [isMobile, setIsMobile] = useState(true);\n  //  #endregion\n\n  //  #region keyboard detected\n  const [keyboardDetected, setKeyboardDetected] = useState(false);\n  const [focusInput, setFocusInput] = useState(null);\n\n  function onKeyboardOnOff(isOpen) {\n    // Write down your handling code\n    if (isOpen) {\n      setKeyboardDetected(true);\n    } else {\n      setKeyboardDetected(false);\n    }\n  }\n\n  let originalPotion = false;\n  window.onload = function () {\n    if (originalPotion === false) originalPotion = window.innerWidth + window.innerHeight;\n  };\n\n  /**\n   * Determine the mobile operating system.\n   * This function returns one of 'iOS', 'Android', 'Windows Phone', or 'unknown'.\n   *\n   * @returns {String}\n   */\n  function getMobileOperatingSystem() {\n    const userAgent = navigator.userAgent || navigator.vendor || window.opera;\n\n    // Windows Phone must come first because its UA also contains \"Android\"\n    if (/windows phone/i.test(userAgent)) {\n      return 'winphone';\n    }\n\n    if (/android/i.test(userAgent)) {\n      return 'android';\n    }\n\n    // iOS detection from: http://stackoverflow.com/a/9039885/177710\n    if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {\n      return 'ios';\n    }\n\n    return '';\n  }\n\n  function applyAfterResize() {\n    if (getMobileOperatingSystem() !== 'ios') {\n      if (originalPotion !== false) {\n        const wasWithKeyboard = document\n          .querySelector('body')\n          .classList.contains('view-withKeyboard');\n        let nowWithKeyboard = false;\n\n        const diff = Math.abs(\n          originalPotion -\n            (document.querySelector(window).width() + document.querySelector(window).height())\n        );\n        if (diff > 100) nowWithKeyboard = true;\n\n        document.querySelector('body').classList.toggle('view-withKeyboard', nowWithKeyboard);\n        if (wasWithKeyboard !== nowWithKeyboard) {\n          onKeyboardOnOff(nowWithKeyboard);\n        }\n      }\n    }\n  }\n  const itemsEvents = ['select', 'textarea', 'input'];\n\n  itemsEvents.forEach((item) => {\n    const items = document.getElementsByTagName(`${item}`);\n    Array.from(items).forEach((i, index) => {\n      if (i.name) {\n        document.querySelector(`${item}[name=${i.id}]`).addEventListener('focus', function (e) {\n          const nowWithKeyboard = e.type === 'focus';\n          document.querySelector('body').classList.toggle('view-withKeyboard', nowWithKeyboard);\n          onKeyboardOnOff(nowWithKeyboard);\n\n          const node = document.getElementById(`${i.id}`);\n          node.select();\n\n          setFocusInput(i.id);\n        });\n\n        document.querySelector(`${item}[name=${i.id}]`).addEventListener('blur', function (e) {\n          const nowWithKeyboard = e.type === 'focus';\n          document.querySelector('body').classList.toggle('view-withKeyboard', nowWithKeyboard);\n          onKeyboardOnOff(nowWithKeyboard);\n\n          setFocusInput(null);\n        });\n      }\n    });\n  });\n\n  document.querySelector('html').addEventListener('resize', function () {\n    if (!open) {\n      applyAfterResize();\n    }\n  });\n  document.querySelector('html').addEventListener('orientationchange', function () {\n    if (!open) {\n      applyAfterResize();\n    }\n  });\n\n  //  #endregion\n\n  //  #region time btns\n  const period = 250;\n  const [timeSecondsTop, setTimeSecondsTop] = useState(0);\n  const [timeSecondsBot, setTimeSecondsBot] = useState(0);\n\n  const timeTop = useRef();\n  const timeBot = useRef();\n\n  useEffect(() => {\n    const topFocus = (focusInput || '').match('top');\n\n    if (timeSecondsTop >= 0 && openCard) {\n      let value = timeSecondsTop;\n\n      if (timeTop.current) {\n        window.clearInterval(timeTop.current);\n        clearInterval(timeTop.current);\n      }\n\n      if (topFocus === null) {\n        timeTop.current = setInterval(() => {\n          value += period;\n          setTimeSecondsTop(value);\n        }, period);\n      } else {\n        setTimeSecondsTop(0);\n      }\n      const accumulatorTimeThreshold = dicoin.recordGenerationRules\n        ? dicoin.recordGenerationRules.accumulatorTimeThreshold\n        : 2000;\n\n      if (timeSecondsTop >= accumulatorTimeThreshold) {\n        window.clearInterval(timeTop.current);\n        clearInterval(timeTop.current);\n      }\n    }\n  }, [timeSecondsTop, openCard, focusInput]);\n\n  useEffect(() => {\n    const botFocus = (focusInput || '').match('bot');\n\n    if (timeSecondsBot >= 0 && openCard) {\n      let value = timeSecondsBot;\n\n      if (timeBot.current) {\n        window.clearInterval(timeBot.current);\n        clearInterval(timeBot.current);\n      }\n\n      if (botFocus === null) {\n        timeBot.current = setInterval(() => {\n          value += period;\n          setTimeSecondsBot(value);\n        }, period);\n      } else {\n        setTimeSecondsBot(0);\n      }\n\n      const accumulatorTimeThreshold = dicoin.recordGenerationRules\n        ? dicoin.recordGenerationRules.accumulatorTimeThreshold\n        : 2000;\n      if (timeSecondsBot >= accumulatorTimeThreshold) {\n        window.clearInterval(timeBot.current);\n        clearInterval(timeBot.current);\n      }\n    }\n  }, [timeSecondsBot, openCard, focusInput]);\n  // #endregion\n\n  //  #region btn count passengers\n  const [topDoor, setTopDoor] = useState({ entry: 0, exit: 0 });\n  const [botDoor, setBotDoor] = useState({ entry: 0, exit: 0 });\n\n  function handleAddCountDoorEntry(type, event) {\n    window.navigator.vibrate(80);\n    const data = (event && parseInt(event.target.value, 10)) || 0;\n\n    if (type === 'top') {\n      setTimeSecondsTop(0);\n      setTopDoor({ ...topDoor, entry: event ? data : topDoor.entry + 1 });\n    } else {\n      setTimeSecondsBot(0);\n      setBotDoor({ ...botDoor, entry: event ? data : botDoor.entry + 1 });\n    }\n  }\n\n  function handleAddCountDoorExit(type, event) {\n    window.navigator.vibrate(80);\n    const data = (event && parseInt(event.target.value, 10)) || 0;\n\n    if (type === 'top') {\n      setTimeSecondsTop(0);\n      setTopDoor({ ...topDoor, exit: event ? data : topDoor.exit + 1 });\n    } else {\n      setTimeSecondsBot(0);\n      setBotDoor({ ...botDoor, exit: event ? data : botDoor.exit + 1 });\n    }\n  }\n  //  #endregion\n\n  //  #region dialog statistics\n  const [openDialogStatistics, setOpenDialogStatistics] = useState(false);\n\n  function handleOpenDialogStatistics() {\n    setOpenDialogStatistics(true);\n  }\n\n  function handleCloseDialogStatistics() {\n    setOpenDialogStatistics(false);\n  }\n  //  #endregion\n\n  //  #region dialog statistics\n  const [openDialogRecordDetails, setOpenDialogRecordDetails] = useState(false);\n  const [dataDialogDetails, setDataDialogDetails] = useState();\n  function handleOpenDialogRecordDetails(data) {\n    setOpenDialogRecordDetails(true);\n    setDataDialogDetails(data);\n  }\n\n  function handleCloseDialogRecordDetails() {\n    setOpenDialogRecordDetails(false);\n  }\n  //  #endregion\n\n  //  #region Download\n  const [openDialogDownload, setOpenDialogDownload] = useState(false);\n\n  function handleOpenDialogDownload() {\n    setOpenDialogDownload(true);\n  }\n\n  function handleCloseDialogDownload() {\n    setOpenDialogDownload(false);\n  }\n  //  #endregion\n\n  // #region Engine\n\n  /**\n   * @type [Dicoin,function]\n   */\n  const [dicoin, setDicoin] = useState(() => new Dicoin());\n  const [events, setEvents] = useState([]);\n  const [tripReported, setTripReported] = useState(false);\n  const [records, setRecords] = useState([]);\n  const [tripTempState, setTripTempState] = useState({});\n  const [tripState, setTripState] = useState({});\n  const [tripType, setTripType] = useState(false);\n  const [didDBStart, setDidDBStart] = useState(false);\n  const geolocation = useGeolocation(\n    { enableHighAccuracy: true, maximumAge: 1500, timeout: 13000 },\n    () => {}\n  );\n  const [stateDoor, setStateDoor] = useState({ top: false, bot: false });\n  const [loading, setLoading] = useState(false);\n  function handleDialogNewExecution(dataDialogNewExecutionToCreate) {\n    localStorage.setItem(\n      'infoCreationExecution',\n      JSON.stringify({\n        routeCode: dataDialogNewExecutionToCreate.routeCode,\n        route: dataDialogNewExecutionToCreate.route,\n        plate: dataDialogNewExecutionToCreate.plate,\n        driverLicense: dataDialogNewExecutionToCreate.driverLicense,\n        nitCompany: dataDialogNewExecutionToCreate.nitCompany,\n        onLine: dataDialogNewExecutionToCreate.onLine,\n      })\n    );\n    const transmisionConfigData = localStorage.getItem('transmissionConfig')\n      ? JSON.parse(localStorage.getItem('transmissionConfig'))\n      : null;\n    const recordGenerationRulesData = localStorage.getItem('recordGenerationRules')\n      ? JSON.parse(localStorage.getItem('recordGenerationRules'))\n      : null;\n    if (!transmisionConfigData || !recordGenerationRulesData) {\n      enqueueSnackbar(t('INVALID_PARAMS'), { variant: 'error' });\n    } else {\n      const trip = new Trip(\n        dataDialogNewExecutionToCreate.routeCode,\n        dataDialogNewExecutionToCreate.route,\n        dataDialogNewExecutionToCreate.plate,\n        dataDialogNewExecutionToCreate.driverLicense,\n        dataDialogNewExecutionToCreate.nitCompany,\n        dicoin.tripErrorReporter.bind(dicoin)\n      );\n      setTripType(dataDialogNewExecutionToCreate.onLine);\n      const transmissionConfig = new TransmissionConfig(\n        dataDialogNewExecutionToCreate.onLine,\n        transmisionConfigData.url,\n        transmisionConfigData.user,\n        transmisionConfigData.password,\n        parseInt(transmisionConfigData.maxRetires, 10),\n        parseInt(transmisionConfigData.delayBetweenRetries, 10),\n        dicoin.tripErrorReporter.bind(dicoin)\n      );\n      const withRouteRules = recordGenerationRulesData.withRoute;\n      const recordGenerationRules = new RecordGenerationRules(\n        parseInt(withRouteRules.distanceThreshold, 10),\n        parseInt(withRouteRules.timeThreshold, 10) * 1000,\n        parseInt(withRouteRules.speedThreshold, 10),\n        withRouteRules.useDoorStateAsTrigger,\n        recordGenerationRulesData.accumulatorTimeThreshold,\n        dicoin.tripErrorReporter.bind(dicoin)\n      );\n      dicoin.startTrip(trip, transmissionConfig, recordGenerationRules);\n    }\n  }\n  useEffect(() => {\n    window.addEventListener('resize', () => {\n      setAvailableHeight(window.innerHeight - 210);\n    });\n    const dataLocal = JSON.parse(localStorage.getItem('infoCreationExecution'));\n    if (dataLocal) {\n      setDataDialogNewExecution({ ...dataDialogNewExecution, ...dataLocal });\n    }\n    dicoin.addListener('TRAVEL', (event) => {\n      switch (event.type) {\n        case EVENT_TYPES.TRIP_REPORT_GENERATED:\n          const { reportContent, fileName } = event.payload;\n          setLoading(false);\n          FileSaver.saveAs(reportContent, fileName);\n          break;\n        case EVENT_TYPES.ERROR_REPORTED:\n          enqueueSnackbar(t(event.payload.message), { variant: 'error' });\n          break;\n        case EVENT_TYPES.TRIP_REPORTED:\n          enqueueSnackbar('Reportado Correctamente', { variant: 'success' });\n          setTripReported(true);\n          break;\n        case EVENT_TYPES.TRIP_STARTED:\n          setTripState(event.payload.state);\n          setTripTempState(event.payload.tempState || {});\n          setOpen(false);\n          setInitialized(true);\n          break;\n        case EVENT_TYPES.TRIP_LOADED:\n          if (event.payload.tripState === 'FINALIZED') {\n            setStateRoute(event.payload.reason);\n            setOpenDialogFinalize(false);\n            setInitialized(false);\n          } else {\n            setInitialized(true);\n          }\n          setTripState(event.payload.state || {});\n          setTripTempState(event.payload.tempState || {});\n          break;\n        case EVENT_TYPES.TRIP_STATE_CHANGED:\n          setTripState(event.payload.state || {});\n          setTripTempState(event.payload.tempState || {});\n          break;\n        case EVENT_TYPES.TRIP_STOPPED:\n          setTripState(event.payload.state || {});\n          setTripTempState(event.payload.tempState || {});\n          break;\n        case EVENT_TYPES.RECORD_GENERATED:\n          const newRecordsGenerated = _.cloneDeep(event.payload.records);\n          setRecords(newRecordsGenerated);\n          break;\n        case EVENT_TYPES.RECORD_UPDATED:\n          const newRecordsUpdated = _.cloneDeep(event.payload.records);\n          setRecords(newRecordsUpdated);\n          break;\n        case EVENT_TYPES.NOTE_ADDED:\n          const newRecordsAndNotesGenerated = _.cloneDeep(event.payload.records);\n          setRecords(newRecordsAndNotesGenerated);\n          break;\n        case EVENT_TYPES.TRIP_TYPE_REPORTED:\n          setTripType(event.payload.online);\n          break;\n        case EVENT_TYPES.TRIP_REMOVED:\n          setTripState({});\n          setTripTempState({});\n          setRecords([]);\n          setInitialized(false);\n          setStateRoute(null);\n          break;\n\n        case EVENT_TYPES.DB_STARTED:\n          setDidDBStart(true);\n          break;\n        default:\n          console.log('UNPROCESSED EVENT', event.type);\n          break;\n      }\n      events.push(event);\n      setEvents([...events]);\n    });\n    return () => {\n      dicoin.removeListener('TRAVEL');\n      dicoin.stopTrip('ABORTED_BY_USER_SECCION', true);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (didDBStart) {\n      dicoin.recoverPersistedState();\n    }\n  }, [didDBStart]);\n\n  useEffect(() => {\n    if (!geolocation.error && geolocation && didDBStart) {\n      if (initialized) {\n        dicoin.reportGeolocationPosition(geolocation);\n      }\n    }\n  }, [geolocation, geolocation.error, initialized, didDBStart]);\n\n  function generateReport() {\n    setLoading(true);\n    dicoin.generateContentReport();\n  }\n\n  function handleDoor(type) {\n    const doorState = { ...stateDoor, [type]: !stateDoor[type] };\n    setStateDoor(doorState);\n  }\n\n  // #endregion\n\n  //  #region dialogNote\n  const [openDialogNote, setOpenDialogNote] = useState(false);\n\n  function handleOpenDialogNote() {\n    setOpenDialogNote(true);\n  }\n\n  function handleCloseDialogNote() {\n    setOpenDialogNote(false);\n  }\n\n  function handleAddNote(note) {\n    setOpenDialogNote(false);\n    dicoin.addNote(note);\n  }\n  //  #endregion\n\n  //  #region stateBtnDoors\n  const [stateCountTopDoor, setStateCountTopDoor] = useState({ entry: 0, exit: 0 });\n  const [stateCountBotDoor, setStateCountBotDoor] = useState({ entry: 0, exit: 0 });\n  useEffect(() => {\n    const accumulatorTimeThreshold = dicoin.recordGenerationRules\n      ? dicoin.recordGenerationRules.accumulatorTimeThreshold\n      : 2000;\n    if (timeSecondsTop >= accumulatorTimeThreshold && topDoor) {\n      const action = () => {\n        setStateCountTopDoor({\n          ...stateCountTopDoor,\n          entry: stateCountTopDoor.entry + topDoor.entry,\n          exit: stateCountTopDoor.exit + topDoor.exit,\n        });\n        dicoin.reportPassengerFlow((topDoor || {}).entry || 0, (topDoor || {}).exit || 0, 0, 0);\n        setTimeout(() => {\n          setTopDoor({ entry: 0, exit: 0 });\n        }, 500);\n      };\n      applierCallBack({ applierSource: 'timeSecondsTop', action });\n    }\n  }, [timeSecondsTop]);\n\n  useEffect(() => {\n    const accumulatorTimeThreshold = dicoin.recordGenerationRules\n      ? dicoin.recordGenerationRules.accumulatorTimeThreshold\n      : 2000;\n    if (timeSecondsBot >= accumulatorTimeThreshold && botDoor) {\n      const action = () => {\n        setStateCountBotDoor({\n          ...stateCountBotDoor,\n          entry: stateCountBotDoor.entry + botDoor.entry,\n          exit: stateCountBotDoor.exit + botDoor.exit,\n        });\n        dicoin.reportPassengerFlow(0, 0, (botDoor || {}).entry || 0, (botDoor || {}).exit || 0);\n        setTimeout(() => {\n          setBotDoor({ entry: 0, exit: 0 });\n        }, 500);\n      };\n      applierCallBack({ applierSource: 'timeSecondsBot', action });\n    }\n  }, [timeSecondsBot]);\n\n  useEffect(() => {\n    if (initialized) {\n      const action = () => {\n        if (botDoor) {\n          setStateCountBotDoor({\n            ...stateCountBotDoor,\n            entry: stateCountBotDoor.entry + botDoor.entry,\n            exit: stateCountBotDoor.exit + botDoor.exit,\n          });\n          dicoin.reportPassengerFlow(0, 0, (botDoor || {}).entry || 0, (botDoor || {}).exit || 0);\n          setTimeout(() => {\n            setBotDoor({ entry: 0, exit: 0 });\n          }, 500);\n        }\n\n        if (topDoor) {\n          setStateCountTopDoor({\n            ...stateCountTopDoor,\n            entry: stateCountTopDoor.entry + topDoor.entry,\n            exit: stateCountTopDoor.exit + topDoor.exit,\n          });\n          dicoin.reportPassengerFlow((topDoor || {}).entry || 0, (topDoor || {}).exit || 0, 0, 0);\n          setTimeout(() => {\n            setTopDoor({ entry: 0, exit: 0 });\n          }, 500);\n        }\n        setTimeSecondsTop(11);\n        setTimeSecondsBot(11);\n      };\n\n      applierCallBack({ applierSource: 'timeSecondsBot', action });\n      dicoin.reportDoorsStatus(stateDoor.top, stateDoor.bot);\n    }\n  }, [stateDoor]);\n\n  //  #endregion\n\n  // #region Dialgo Confirm remove\n  const [openDialogConfirm, setOpenDialogConfirm] = useState(false);\n  function handleOpenDialogConfirm() {\n    setOpenDialogConfirm(true);\n  }\n\n  function handleCloseDialogConfirm() {\n    setOpenDialogConfirm(false);\n  }\n\n  function handleComfirmRemoveTrip() {\n    setOpenDialogConfirm(false);\n    dicoin.clearTrip();\n  }\n\n  // #endregion\n\n  //  #region dialg finalize\n  const [openDialogFinalize, setOpenDialogFinalize] = useState(false);\n  const [stateRoute, setStateRoute] = useState(null);\n\n  function handleOpenDialogFinalize() {\n    if (dicoin.trip.route === 'NA') {\n      setStateRoute('NA');\n      setOpenDialogFinalize(false);\n      setInitialized(false);\n      setOpenCard(false);\n      dicoin.stopTrip('NA', true, true);\n    } else {\n      setOpenDialogFinalize(true);\n    }\n  }\n\n  function handleCloseDialogFinalize() {\n    setOpenDialogFinalize(false);\n  }\n\n  function hadleStateRoute(state) {\n    setStateRoute(state);\n    setOpenDialogFinalize(false);\n    setInitialized(false);\n    setOpenCard(false);\n    dicoin.stopTrip(state, true, true);\n  }\n  //  #endregion\n\n  function handleReportTrip() {\n    dicoin.reportTripState();\n  }\n\n  function getLatLngasString() {\n    const { latitude, longitude } = ((tripTempState || {}).geolocationPosition || {}).coords || {};\n    if (\n      latitude == null ||\n      longitude == null ||\n      latitude === undefined ||\n      longitude === undefined\n    ) {\n      return '---,---';\n    }\n    console.log('=== toFixed getLatLngasString' , latitude,longitude, latitude.toFixed,longitude.toFixed );\n    return `${latitude.toFixed(5)},${longitude.toFixed(5)}`;\n  }\n\n  function getSpeedAsString() {\n    const { speed } = ((tripTempState || {}).geolocationPosition || {}).coords || {};\n    if (speed === null || speed === undefined) return '-- km/h';\n    console.log('=== toFixed getSpeedAsString' , speed, speed.toFixed );\n    return `${speed.toFixed(0)} km/h`;\n  }\n\n  function getDopAsString() {\n    const { dop } = ((tripTempState || {}).geolocationPosition || {}).coords || {};\n    if (dop === null || dop === undefined) return '--';\n    console.log('=== toFixed getDopAsString' , dop, dop.toFixed );\n    return `${dop.toFixed ? dop.toFixed(1) : dop}`;\n  }\n\n  function getAccuaracyAsString() {\n    const { accuracy } = ((tripTempState || {}).geolocationPosition || {}).coords || {};\n    if (accuracy === null || accuracy === undefined) return '--';\n    console.log('=== toFixed getAccuaracyAsString' , accuracy, accuracy.toFixed );\n    return `${accuracy.toFixed(0)}`;\n  }\n\n  function openMaps() {\n    if (!(((tripTempState || {}).geolocationPosition || {}).coords || {}).latitude) return;\n    const { latitude, longitude } = tripTempState.geolocationPosition.coords;\n    window.open(`https://maps.google.com?q=${latitude},${longitude}`);\n  }\n\n  return (\n    <TravelContext.Provider\n      value={{\n        hadleOpenBtnDrag,\n        hadleCloseBtnDrag,\n        setDisplayBtnDisabled,\n        handleAddCountDoorEntry,\n        handleAddCountDoorExit,\n        handleOpenDialogRecordDetails,\n        handleDoor,\n        setProgressLoading,\n        setAvailableHeight,\n        openCard,\n        displayBtnDisabled,\n        keyboardDetected,\n        cards,\n        topDoor,\n        botDoor,\n        stateCountTopDoor,\n        stateCountBotDoor,\n        timeSecondsTop,\n        timeSecondsBot,\n        stateDoor,\n        initialized,\n        stateRoute,\n        progressLoading,\n        records,\n        tripTempState,\n        tripState,\n        dicoin,\n        availableHeight,\n        rowHeight,\n      }}\n    >\n      <div>\n        {(orientation === 'portrait' && isMobile) || (orientation === 'landscape' && !isMobile) ? (\n          <Root\n            header={\n              <div className=\"w-full flex flex-wrap place-content-start\">\n                <div className=\"w-full py-10 px-16 flex items-start justify-between\">\n                  <div>\n                    {configFuse.navbar.display && configFuse.navbar.position === 'left' && (\n                      <>\n                        <Hidden lgDown>\n                          {(configFuse.navbar.style === 'style-3' ||\n                            configFuse.navbar.style === 'style-3-dense') && (\n                            <NavbarToggleButton className=\"w-40 h-40 p-0 mx-0\" />\n                          )}\n\n                          {configFuse.navbar.style === 'style-1' && !navbar.open && (\n                            <NavbarToggleButton className=\"w-40 h-40 p-0 mx-0\" />\n                          )}\n                        </Hidden>\n\n                        <Hidden lgUp>\n                          <NavbarToggleButton className=\"w-40 h-40 p-0 mx-0 sm:mx-8\" />\n                        </Hidden>\n                      </>\n                    )}\n\n                    <>\n                      {initialized && (\n                        <Button\n                          variant=\"contained\"\n                          className={`${classes.btnHeaderWhite} mr-5`}\n                          onClick={() => {\n                            handleOpenDialogNote();\n                          }}\n                        >\n                          <Icon>note_add</Icon>\n                        </Button>\n                      )}\n                      {((initialized && stateRoute === null) ||\n                        (!initialized && stateRoute !== null)) && (\n                        <Button\n                          variant=\"contained\"\n                          className={`${classes.btnHeaderWhite} mr-5`}\n                          onClick={() => {\n                            handleOpenDialogStatistics();\n                          }}\n                        >\n                          <Icon>show_chart</Icon>\n                        </Button>\n                      )}\n                      {initialized && (\n                        <Button\n                          id=\"myBtnHeaderCards213\"\n                          variant=\"contained\"\n                          className={`${classes.btnHeaderWhite} ${\n                            displayBtnDisabled && classes.noHover\n                          }`}\n                          disabled={progressLoading || (!displayBtnDisabled && openCard)}\n                          onClick={(evt) => {\n                            evt.stopPropagation();\n                            hadleOpenBtnDrag();\n                          }}\n                        >\n                          {progressLoading ? <CircularProgress size={25} /> : <Icon>adjust</Icon>}\n                        </Button>\n                      )}\n\n                      {!initialized && stateRoute !== null && (\n                        <Button\n                          variant=\"contained\"\n                          className={`${classes.btnHeader} mr-5`}\n                          color=\"error\"\n                          onClick={() => {\n                            handleOpenDialogConfirm();\n                          }}\n                        >\n                          <Icon>delete_forever</Icon>\n                        </Button>\n                      )}\n                      {!initialized && stateRoute !== null && (\n                        <Button\n                          variant=\"contained\"\n                          className={`${classes.btnHeader} mr-5`}\n                          color=\"success\"\n                          disabled={tripReported || tripType}\n                          onClick={() => {\n                            handleReportTrip();\n                          }}\n                        >\n                          <Icon>publish</Icon>\n                        </Button>\n                      )}\n                    </>\n                  </div>\n\n                  <div>\n                    {!initialized && stateRoute === null && (\n                      <Button\n                        variant=\"contained\"\n                        color=\"success\"\n                        onClick={() => {\n                          handleClickOpen();\n                        }}\n                      >\n                        <Icon>flag</Icon>\n                        {t('TRAVEL_HEADER_START')}\n                      </Button>\n                    )}\n\n                    {initialized && stateRoute === null && (\n                      <Button\n                        variant=\"contained\"\n                        color=\"error\"\n                        onClick={() => {\n                          handleOpenDialogFinalize();\n                        }}\n                      >\n                        {t('TRAVEL_HEADER_FINALIZE')}\n                        <Icon>flag</Icon>\n                      </Button>\n                    )}\n                    {!initialized && stateRoute !== null && (\n                      <Button\n                        variant=\"contained\"\n                        className={`${classes.btnSilver}`}\n                        onClick={(evt) => {\n                          evt.stopPropagation();\n                          generateReport();\n                        }}\n                      >\n                        <Icon>assignment_returned</Icon>\n                        {t('TRAVEL_HEADER_DOWNLOAD')}\n                      </Button>\n                    )}\n                  </div>\n                </div>\n\n                <div className=\"w-full flex items-center pt-5 pb-10 px-16\">\n                  <Typography className={`text-xs mr-10 ${classes.textother}`} onClick={openMaps}>\n                    <Icon className={`${classes.TransformRotate} text-sm mr-5`}>send</Icon>\n                    {getLatLngasString()}\n                  </Typography>\n\n                  <Typography className={`text-xs mr-10 ${classes.textother}`} onClick={openMaps}>\n                    <Icon className=\"text-sm mr-5\">av_timer</Icon>\n                    {getSpeedAsString()}\n                  </Typography>\n\n                  <Typography className={`text-xs mr-10 ${classes.textother}`} onClick={openMaps}>\n                    <Icon className=\"text-sm mr-5\">satellite_alt</Icon>\n                    {getDopAsString()}\n                  </Typography>\n\n                  <Typography className={`text-xs mr-10 ${classes.textother}`} onClick={openMaps}>\n                    <Icon className=\"text-sm mr-5\">radio_button_checked</Icon>\n                    {getAccuaracyAsString()}\n                  </Typography>\n\n                  <Typography className={`text-xs mr-10 ${classes.textother}`} onClick={openMaps}>\n                    <Icon className=\"text-sm mr-5\">sync_alt</Icon>\n                    {dataDialogNewExecution.onLine\n                      ? `${records.filter((r) => r.state === 'SENT').length || '0'}/`\n                      : ''}{' '}\n                    {records.filter((r) => r.type === 'RECORD').length || '0'}\n                  </Typography>\n                </div>\n              </div>\n            }\n            content={\n              <div className={`${classes.contenTable} p-10`}>\n                <TableExecution\n                  accumulatorTimeThreshold={\n                    dicoin && dicoin.recordGenerationRules\n                      ? dicoin.recordGenerationRules.accumulatorTimeThreshold\n                      : 2000\n                  }\n                />\n                {open && (\n                  <DialogCreateExecution\n                    {...{\n                      open,\n                      handleClose,\n                      dataDialogNewExecution,\n                      setDataDialogNewExecution,\n                      handleDialogNewExecution,\n                    }}\n                  />\n                )}\n                {openDialogNote && (\n                  <DialogAddNote\n                    {...{ open: openDialogNote, handleClose: handleCloseDialogNote, handleAddNote }}\n                  />\n                )}\n                {openDialogFinalize && (\n                  <DialogFinalize\n                    {...{\n                      open: openDialogFinalize,\n                      handleClose: handleCloseDialogFinalize,\n                      hadleStateRoute,\n                    }}\n                  />\n                )}\n                {openDialogStatistics && (\n                  <DialogStatistics\n                    {...{ open: openDialogStatistics, handleClose: handleCloseDialogStatistics }}\n                  />\n                )}\n                {openDialogRecordDetails && (\n                  <DialogRecordDetail\n                    {...{\n                      open: openDialogRecordDetails,\n                      handleClose: handleCloseDialogRecordDetails,\n                      record: dataDialogDetails,\n                    }}\n                  />\n                )}\n                {openDialogDownload && (\n                  <DialogDownload\n                    {...{ open: openDialogDownload, handleClose: handleCloseDialogDownload }}\n                  />\n                )}\n                {openDialogConfirm && (\n                  <DialogConfirm\n                    {...{\n                      open: openDialogConfirm,\n                      handleClose: handleCloseDialogConfirm,\n                      handleAction: handleComfirmRemoveTrip,\n                    }}\n                  />\n                )}\n              </div>\n            }\n          />\n        ) : (\n          <Root\n            header={\n              <div className=\"w-full flex flex-wrap place-content-start\">\n                <div className=\"w-full py-10 px-16 flex items-center justify-center h-screen\">\n                  <Typography className=\"text-center w-full text-sm\">\n                    <b>{t('TRAVEL_APPLICATION_ORIENTATION_ERROR_MESSAGE')}</b>\n                  </Typography>\n                </div>\n              </div>\n            }\n          />\n        )}\n      </div>\n    </TravelContext.Provider>\n  );\n}\n\nexport default TravelsPage;\n"]},"metadata":{},"sourceType":"module"}