{"ast":null,"code":"var _jsxFileName = \"/Users/sebastianmolano/NebulaE/Projects/GTPC/dicon-audit-pwa/frontend/dicon-audit-pwa/src/app/main/analysis/dialogs/DialogStatistics.js\";\nimport { useContext, useEffect, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport moment from 'moment';\nimport { Button, Dialog, DialogActions, DialogContent, DialogTitle, Typography, Icon } from '@mui/material';\nimport { makeStyles } from '@mui/styles';\nimport AnalysisContext from '../Analysis-context/AnalysisContext';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst useStyles = makeStyles({});\nexport default function DialogStatistics(props) {\n  const {\n    open,\n    handleClose\n  } = props;\n  const {\n    appFileContent\n  } = useContext(AnalysisContext);\n  const {\n    t\n  } = useTranslation('analysisPage');\n  const classes = useStyles();\n\n  function getRecordAttemptsLatencyAverage(record) {\n    const attepms = record.stats.attempts || [];\n    const attempsLength = attepms.length;\n    const latencyTotal = attepms.reduce((acc, val) => acc + (val.latency || 0), 0);\n    return latencyTotal && attempsLength ? latencyTotal / attempsLength : 0;\n  }\n\n  function getRecordAttemptsLatencySum(record) {\n    const attepms = record.stats.attempts || [];\n    if (attepms.length === 0) return '--';\n    const latencyTotal = attepms.reduce((acc, val) => acc + (val.latency || 0), 0);\n    return latencyTotal;\n  }\n\n  const [recordSummary, setRecordSummary] = useState({\n    totalRecord: 0,\n    totalLatency: 0,\n    pending: 0,\n    retrying: 0,\n    sent: 0,\n    error: 0,\n    frontDoorInput: 0,\n    backDoorInput: 0,\n    frontDoorOutput: 0,\n    backDoorOutput: 0,\n    timestamp: 0,\n    endTimestamp: 0,\n    taveledTime: 0\n  });\n  useEffect(() => {\n    if (appFileContent) {\n      const recordsSummary = appFileContent.reduce((acc, record) => {\n        if (record.type === 'RECORD') {\n          console.log(record);\n          acc.totalLatency += getRecordAttemptsLatencyAverage(record);\n          acc.totalRecord += 1;\n          if (record.state === 'PERSISTED') acc.pending += 1;\n          if (record.state === 'SENDING') acc.retrying += 1;\n          if (record.state === 'SENT') acc.sent += 1;\n          if (record.state === 'ERROR') acc.error += 1;\n          acc.frontDoorInput += record.payload.frontDoorInput;\n          acc.backDoorInput += record.payload.backDoorInput;\n          acc.frontDoorOutput += record.payload.frontDoorOutput;\n          acc.backDoorOutput += record.payload.backDoorOutput;\n          if (!acc.timestamp) acc.timestamp = record.timestamp;\n          console.log('record.tripState', record.tripState.endTimestamp);\n          if (record.tripState.endTimestamp) acc.endTimestamp += record.tripState.endTimestamp;\n\n          if (record.tripState.endTimestamp) {\n            acc.taveledTime = record.tripState.endTimestamp - acc.timestamp;\n          } else {\n            acc.taveledTime = record.timestamp - acc.timestamp;\n          }\n        }\n\n        return acc;\n      }, {\n        totalRecord: 0,\n        totalLatency: 0,\n        pending: 0,\n        retrying: 0,\n        sent: 0,\n        error: 0,\n        frontDoorInput: 0,\n        backDoorInput: 0,\n        frontDoorOutput: 0,\n        backDoorOutput: 0,\n        timestamp: 0,\n        endTimestamp: 0,\n        taveledTime: 0\n      });\n      setRecordSummary(recordsSummary);\n    }\n  }, [appFileContent]);\n\n  function msToTime(duration) {\n    const seconds = Math.floor(duration / 1000 % 60);\n    const minutes = Math.floor(duration / (1000 * 60) % 60);\n    const hours = Math.floor(duration / (1000 * 60 * 60) % 24);\n    return `${hours < 9 ? `0${hours}` : hours}:${minutes < 9 ? `0${minutes}` : minutes}:${seconds < 9 ? `0${seconds}` : seconds}`;\n  }\n\n  return /*#__PURE__*/_jsxDEV(Dialog, {\n    open: open,\n    onClose: handleClose,\n    \"aria-labelledby\": \"alert-dialog-title\",\n    \"aria-describedby\": \"alert-dialog-description\",\n    children: [/*#__PURE__*/_jsxDEV(DialogTitle, {\n      id: \"alert-dialog-title\",\n      children: t('ANALYSIS_DIALOG_STATISTICS_TITLE')\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(DialogContent, {\n      dividers: true,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-start\",\n        children: [/*#__PURE__*/_jsxDEV(Icon, {\n          className: \"mr-10\",\n          children: \"sync_alt\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 119,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(Typography, {\n            children: [recordSummary.sent < 9 ? `0${recordSummary.sent}` : recordSummary.sent, \"/\", recordSummary.totalRecord < 9 ? `0${recordSummary.totalRecord}` : recordSummary.totalRecord, \",\", t('TRAVEL_DIALOG_STATISTICS_PENDING_EVENTS'), \": \", /*#__PURE__*/_jsxDEV(\"b\", {\n              children: recordSummary.pending\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 126,\n              columnNumber: 64\n            }, this), \",\", t('TRAVEL_DIALOG_STATISTICS_RETRANSMISSION_ATTEMPT'), \":\", ' ', /*#__PURE__*/_jsxDEV(\"b\", {\n              children: recordSummary.retrying\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 128,\n              columnNumber: 15\n            }, this), \",\", t('TRAVEL_DIALOG_STATISTICS_TRANSMISSION_ERRORS'), \":\", /*#__PURE__*/_jsxDEV(\"b\", {\n              children: recordSummary.error\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 129,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 121,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Typography, {\n            children: [t('TRAVEL_DIALOG_STATISTICS_TRANSMISSION_LATENCY'), \":\", ' ', /*#__PURE__*/_jsxDEV(\"b\", {\n              children: recordSummary.totalLatency / recordSummary.totalRecord > 0 ? `${parseInt(recordSummary.totalLatency / recordSummary.totalRecord, 10)}milisegundos` : '--'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 133,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 131,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-start mt-10\",\n        children: [/*#__PURE__*/_jsxDEV(Icon, {\n          className: \"mr-10\",\n          children: \"people_alt\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 142,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(Typography, {\n            children: [t('TRAVEL_DIALOG_STATISTICS_INCOME'), \":\", ' ', /*#__PURE__*/_jsxDEV(\"b\", {\n              children: [recordSummary.frontDoorInput + recordSummary.backDoorInput, \", \"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 146,\n              columnNumber: 15\n            }, this), t('TRAVEL_DIALOG_STATISTICS_DEPARTURES'), \":\", ' ', /*#__PURE__*/_jsxDEV(\"b\", {\n              children: recordSummary.frontDoorOutput + recordSummary.backDoorOutput\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 148,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 144,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Typography, {\n            children: [t('TRAVEL_DIALOG_STATISTICS_PASSENGERS_IN_BUS'), \":\", ' ', /*#__PURE__*/_jsxDEV(\"b\", {\n              children: recordSummary.frontDoorInput + recordSummary.backDoorInput - (recordSummary.frontDoorOutput + recordSummary.backDoorOutput)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 152,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 150,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Typography, {\n            children: [t('TRAVEL_DIALOG_STATISTICS_FRONT_DOOR'), \":\", ' ', /*#__PURE__*/_jsxDEV(\"b\", {\n              children: [\"+\", recordSummary.frontDoorInput, \" -\", recordSummary.frontDoorOutput]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 160,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 158,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Typography, {\n            children: [t('TRAVEL_DIALOG_STATISTICS_BACK_DOOR'), \":\", ' ', /*#__PURE__*/_jsxDEV(\"b\", {\n              children: [\"+\", recordSummary.backDoorInput, \" -\", recordSummary.backDoorOutput]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 166,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 164,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 143,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-start mt-10\",\n        children: [/*#__PURE__*/_jsxDEV(Icon, {\n          className: \"mr-10\",\n          children: \"access_time\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 173,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(Typography, {\n            children: [t('TRAVEL_DIALOG_STATISTICS_LAPSE_OF_TIME'), \":\", ' ', /*#__PURE__*/_jsxDEV(\"b\", {\n              children: [\" \", msToTime(recordSummary.taveledTime)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 177,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 175,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Typography, {\n            children: [t('TRAVEL_DIALOG_STATISTICS_START'), \":\", ' ', /*#__PURE__*/_jsxDEV(\"b\", {\n              children: [\" \", moment(recordSummary.timestamp).format('DD/MM/YYYY HH:mm:ss')]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 181,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 179,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Typography, {\n            children: [t('TRAVEL_DIALOG_STATISTICS_END'), \":\", ' ', /*#__PURE__*/_jsxDEV(\"b\", {\n              children: recordSummary.endTimestamp ? moment(recordSummary.endTimestamp).format('DD/MM/YYYY HH:mm:ss') : '--/--/--- --:--:--'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 185,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 183,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 174,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(DialogActions, {\n      children: /*#__PURE__*/_jsxDEV(Button, {\n        onClick: handleClose,\n        variant: \"contained\",\n        color: \"error\",\n        children: t('ANALYSIS_DIALOG_STATISTICS_CLOSE')\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 110,\n    columnNumber: 5\n  }, this);\n}","map":{"version":3,"sources":["/Users/sebastianmolano/NebulaE/Projects/GTPC/dicon-audit-pwa/frontend/dicon-audit-pwa/src/app/main/analysis/dialogs/DialogStatistics.js"],"names":["useContext","useEffect","useState","useTranslation","moment","Button","Dialog","DialogActions","DialogContent","DialogTitle","Typography","Icon","makeStyles","AnalysisContext","useStyles","DialogStatistics","props","open","handleClose","appFileContent","t","classes","getRecordAttemptsLatencyAverage","record","attepms","stats","attempts","attempsLength","length","latencyTotal","reduce","acc","val","latency","getRecordAttemptsLatencySum","recordSummary","setRecordSummary","totalRecord","totalLatency","pending","retrying","sent","error","frontDoorInput","backDoorInput","frontDoorOutput","backDoorOutput","timestamp","endTimestamp","taveledTime","recordsSummary","type","console","log","state","payload","tripState","msToTime","duration","seconds","Math","floor","minutes","hours","parseInt","format"],"mappings":"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","sourcesContent":["import { useContext, useEffect, useState } from 'react';\n\nimport { useTranslation } from 'react-i18next';\nimport moment from 'moment';\nimport {\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  Typography,\n  Icon,\n} from '@mui/material';\nimport { makeStyles } from '@mui/styles';\nimport AnalysisContext from '../Analysis-context/AnalysisContext';\n\nconst useStyles = makeStyles({});\n\nexport default function DialogStatistics(props) {\n  const { open, handleClose } = props;\n  const { appFileContent } = useContext(AnalysisContext);\n  const { t } = useTranslation('analysisPage');\n  const classes = useStyles();\n\n  function getRecordAttemptsLatencyAverage(record) {\n    const attepms = record.stats.attempts || [];\n    const attempsLength = attepms.length;\n    const latencyTotal = attepms.reduce((acc, val) => acc + (val.latency || 0), 0);\n    return latencyTotal && attempsLength ? latencyTotal / attempsLength : 0;\n  }\n\n  function getRecordAttemptsLatencySum(record) {\n    const attepms = record.stats.attempts || [];\n    if (attepms.length === 0) return '--';\n    const latencyTotal = attepms.reduce((acc, val) => acc + (val.latency || 0), 0);\n    return latencyTotal;\n  }\n\n  const [recordSummary, setRecordSummary] = useState({\n    totalRecord: 0,\n    totalLatency: 0,\n    pending: 0,\n    retrying: 0,\n    sent: 0,\n    error: 0,\n    frontDoorInput: 0,\n    backDoorInput: 0,\n    frontDoorOutput: 0,\n    backDoorOutput: 0,\n    timestamp: 0,\n    endTimestamp: 0,\n    taveledTime: 0,\n  });\n  useEffect(() => {\n    if (appFileContent) {\n      const recordsSummary = appFileContent.reduce(\n        (acc, record) => {\n          if (record.type === 'RECORD') {\n              console.log(record)\n            acc.totalLatency += getRecordAttemptsLatencyAverage(record);\n            acc.totalRecord += 1;\n            if (record.state === 'PERSISTED') acc.pending += 1;\n            if (record.state === 'SENDING') acc.retrying += 1;\n            if (record.state === 'SENT') acc.sent += 1;\n            if (record.state === 'ERROR') acc.error += 1;\n            acc.frontDoorInput += record.payload.frontDoorInput;\n            acc.backDoorInput += record.payload.backDoorInput;\n            acc.frontDoorOutput += record.payload.frontDoorOutput;\n            acc.backDoorOutput += record.payload.backDoorOutput;\n            if (!acc.timestamp) acc.timestamp = record.timestamp;\n            console.log('record.tripState', record.tripState.endTimestamp);\n            if (record.tripState.endTimestamp) acc.endTimestamp += record.tripState.endTimestamp;\n            if (record.tripState.endTimestamp) {\n              acc.taveledTime = record.tripState.endTimestamp - acc.timestamp;\n            } else {\n              acc.taveledTime = record.timestamp - acc.timestamp;\n            }\n          }\n          return acc;\n        },\n        {\n          totalRecord: 0,\n          totalLatency: 0,\n          pending: 0,\n          retrying: 0,\n          sent: 0,\n          error: 0,\n          frontDoorInput: 0,\n          backDoorInput: 0,\n          frontDoorOutput: 0,\n          backDoorOutput: 0,\n          timestamp: 0,\n          endTimestamp: 0,\n          taveledTime: 0,\n        }\n      );\n      setRecordSummary(recordsSummary);\n    }\n  }, [appFileContent]);\n  function msToTime(duration) {\n    const seconds = Math.floor((duration / 1000) % 60);\n    const minutes = Math.floor((duration / (1000 * 60)) % 60);\n    const hours = Math.floor((duration / (1000 * 60 * 60)) % 24);\n\n    return `${hours < 9 ? `0${hours}` : hours}:${minutes < 9 ? `0${minutes}` : minutes}:${\n      seconds < 9 ? `0${seconds}` : seconds\n    }`;\n  }\n  return (\n    <Dialog\n      open={open}\n      onClose={handleClose}\n      aria-labelledby=\"alert-dialog-title\"\n      aria-describedby=\"alert-dialog-description\"\n    >\n      <DialogTitle id=\"alert-dialog-title\">{t('ANALYSIS_DIALOG_STATISTICS_TITLE')}</DialogTitle>\n      <DialogContent dividers>\n        <div className=\"flex items-start\">\n          <Icon className=\"mr-10\">sync_alt</Icon>\n          <div>\n            <Typography>\n              {recordSummary.sent < 9 ? `0${recordSummary.sent}` : recordSummary.sent}/\n              {recordSummary.totalRecord < 9\n                ? `0${recordSummary.totalRecord}`\n                : recordSummary.totalRecord}\n              ,{t('TRAVEL_DIALOG_STATISTICS_PENDING_EVENTS')}: <b>{recordSummary.pending}</b>,\n              {t('TRAVEL_DIALOG_STATISTICS_RETRANSMISSION_ATTEMPT')}:{' '}\n              <b>{recordSummary.retrying}</b>,{t('TRAVEL_DIALOG_STATISTICS_TRANSMISSION_ERRORS')}:\n              <b>{recordSummary.error}</b>\n            </Typography>\n            <Typography>\n              {t('TRAVEL_DIALOG_STATISTICS_TRANSMISSION_LATENCY')}:{' '}\n              <b>\n                {recordSummary.totalLatency / recordSummary.totalRecord > 0\n                  ? `${parseInt(recordSummary.totalLatency / recordSummary.totalRecord, 10)}milisegundos`\n                  : '--'}\n              </b>\n            </Typography>\n          </div>\n        </div>\n        <div className=\"flex items-start mt-10\">\n          <Icon className=\"mr-10\">people_alt</Icon>\n          <div>\n            <Typography>\n              {t('TRAVEL_DIALOG_STATISTICS_INCOME')}:{' '}\n              <b>{recordSummary.frontDoorInput + recordSummary.backDoorInput}, </b>\n              {t('TRAVEL_DIALOG_STATISTICS_DEPARTURES')}:{' '}\n              <b>{recordSummary.frontDoorOutput + recordSummary.backDoorOutput}</b>\n            </Typography>\n            <Typography>\n              {t('TRAVEL_DIALOG_STATISTICS_PASSENGERS_IN_BUS')}:{' '}\n              <b>\n                {recordSummary.frontDoorInput +\n                  recordSummary.backDoorInput -\n                  (recordSummary.frontDoorOutput + recordSummary.backDoorOutput)}\n              </b>\n            </Typography>\n            <Typography>\n              {t('TRAVEL_DIALOG_STATISTICS_FRONT_DOOR')}:{' '}\n              <b>\n                +{recordSummary.frontDoorInput} -{recordSummary.frontDoorOutput}\n              </b>\n            </Typography>\n            <Typography>\n              {t('TRAVEL_DIALOG_STATISTICS_BACK_DOOR')}:{' '}\n              <b>\n                +{recordSummary.backDoorInput} -{recordSummary.backDoorOutput}\n              </b>\n            </Typography>\n          </div>\n        </div>\n        <div className=\"flex items-start mt-10\">\n          <Icon className=\"mr-10\">access_time</Icon>\n          <div>\n            <Typography>\n              {t('TRAVEL_DIALOG_STATISTICS_LAPSE_OF_TIME')}:{' '}\n              <b> {msToTime(recordSummary.taveledTime)}</b>\n            </Typography>\n            <Typography>\n              {t('TRAVEL_DIALOG_STATISTICS_START')}:{' '}\n              <b> {moment(recordSummary.timestamp).format('DD/MM/YYYY HH:mm:ss')}</b>\n            </Typography>\n            <Typography>\n              {t('TRAVEL_DIALOG_STATISTICS_END')}:{' '}\n              <b>\n                {recordSummary.endTimestamp\n                  ? moment(recordSummary.endTimestamp).format('DD/MM/YYYY HH:mm:ss')\n                  : '--/--/--- --:--:--'}\n              </b>\n            </Typography>\n          </div>\n        </div>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={handleClose} variant=\"contained\" color=\"error\">\n          {t('ANALYSIS_DIALOG_STATISTICS_CLOSE')}\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}