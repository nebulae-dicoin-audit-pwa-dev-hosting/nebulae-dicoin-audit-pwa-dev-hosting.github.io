{"ast":null,"code":"import _classCallCheck from\"/Users/sebastianmolano/NebulaE/Projects/GTPC/dicon-audit-pwa/frontend/dicon-audit-pwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/sebastianmolano/NebulaE/Projects/GTPC/dicon-audit-pwa/frontend/dicon-audit-pwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import Auth0Lock from'auth0-lock';import axios from'axios';import jwtDecode from'jwt-decode';import AUTH_CONFIG from'./auth0ServiceConfig';var Auth0Service=/*#__PURE__*/function(){function Auth0Service(){var _this=this;_classCallCheck(this,Auth0Service);this.sdk={auth0Manage:null};this.login=function(){if(!_this.lock){console.warn(\"Auth0 Service didn't initialize, check your configuration\");return false;}// Call the show method to display the widget.\nreturn _this.lock.show();};this.register=function(){if(!_this.lock){console.warn(\"Auth0 Service didn't initialize, check your configuration\");return false;}return _this.lock.show({initialScreen:'signUp'});};this.handleAuthentication=function(){if(!_this.lock){return false;}// Add a callback for Lock's `authenticated` event\n_this.lock.on('authenticated',_this.setSession);// Add a callback for Lock's `authorization_error` event\n_this.lock.on('authorization_error',function(err){console.warn(\"Error: \".concat(err.error,\". Check the console for further details.\"));});return true;};this.onAuthenticated=function(callback){if(!_this.lock){return false;}return _this.lock.on('authenticated',callback);};this.setSession=function(authResult){if(authResult&&authResult.accessToken&&authResult.idToken){// Set the time that the access token will expire at\nvar expiresAt=JSON.stringify(authResult.expiresIn*1000+new Date().getTime());localStorage.setItem('access_token',authResult.accessToken);localStorage.setItem('id_token',authResult.idToken);localStorage.setItem('expires_at',expiresAt);}};this.logout=function(){// Clear access token and ID token from local storage\nlocalStorage.removeItem('access_token');localStorage.removeItem('id_token');localStorage.removeItem('expires_at');localStorage.removeItem('auth0.ssodata');};this.isAuthenticated=function(){if(!_this.lock){return false;}// Check whether the current time is past the\n// access token's expiry time\nvar expiresAt=JSON.parse(localStorage.getItem('expires_at'));var isNotExpired=new Date().getTime()<expiresAt;if(isNotExpired){return true;}_this.logout();return false;};this.getUserData=function(){return new Promise(function(resolve,reject){var tokenData=_this.getTokenData();var userId=tokenData.sub;var auth0UserUrl=\"https://\".concat(AUTH_CONFIG.domain,\"/api/v2/users/\").concat(userId);axios.get(auth0UserUrl,{headers:{'Content-Type':'application/json',Authorization:\"Bearer \".concat(_this.getAccessToken())}}).then(function(response){resolve(response.data);}).catch(function(error){// handle error\nconsole.warn('Cannot retrieve user data',error);reject(error);});});};this.updateUserData=function(userMetadata){var tokenData=_this.getTokenData();var userId=tokenData.sub;var auth0UserUrl=\"https://\".concat(AUTH_CONFIG.domain,\"/api/v2/users/\").concat(userId);var dataObj=JSON.stringify({user_metadata:userMetadata});return axios.patch(auth0UserUrl,dataObj,{headers:{'Content-Type':'application/json',Authorization:\"Bearer \".concat(_this.getAccessToken())}});};this.getAccessToken=function(){return localStorage.getItem('access_token');};this.getIdToken=function(){return window.localStorage.getItem('id_token');};this.getTokenData=function(){var token=_this.getIdToken();var decoded=jwtDecode(token);if(!decoded){return null;}return decoded;};}_createClass(Auth0Service,[{key:\"init\",value:function init(success){if(Object.entries(AUTH_CONFIG).length===0&&AUTH_CONFIG.constructor===Object){if(process.env.NODE_ENV==='development'){console.warn('Missing Auth0 configuration at src/app/services/auth0Service/auth0ServiceConfig.js');}success(false);return;}this.lock=new Auth0Lock(AUTH_CONFIG.clientId,AUTH_CONFIG.domain,{autoclose:true,socialButtonStyle:'big',auth:{// redirect: false,\nredirectUrl:AUTH_CONFIG.callbackUrl,responseType:'token id_token',audience:\"https://\".concat(AUTH_CONFIG.domain,\"/api/v2/\"),params:{scope:'openid profile email user_metadata app_metadata picture update:current_user_metadata create:current_user_metadata read:current_user'}}});this.handleAuthentication();success(true);}}]);return Auth0Service;}();var instance=new Auth0Service();export default instance;","map":null,"metadata":{},"sourceType":"module"}