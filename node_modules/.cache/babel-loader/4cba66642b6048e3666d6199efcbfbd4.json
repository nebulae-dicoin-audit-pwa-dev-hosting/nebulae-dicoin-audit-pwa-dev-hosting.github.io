{"ast":null,"code":"var _jsxFileName = \"/Users/sebastianmolano/NebulaE/Projects/GTPC/dicon-audit-pwa/frontend/dicon-audit-pwa/src/app/main/travels/dialogs/DialogStatistics.js\";\nimport { useState, useEffect, useContext } from 'react';\nimport moment from 'moment';\nimport { useTranslation } from 'react-i18next';\nimport { Button, Dialog, DialogActions, DialogContent, DialogTitle, Typography, Icon } from '@mui/material';\nimport { makeStyles } from '@mui/styles';\nimport TravelContext from '../travel-context/TravelContext';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst useStyles = makeStyles({});\nexport default function DialogStatistics(props) {\n  const {\n    open,\n    handleClose\n  } = props;\n  const {\n    t\n  } = useTranslation('travelsPage');\n  const classes = useStyles();\n  const {\n    records,\n    tripState,\n    dicoin\n  } = useContext(TravelContext);\n  const [recordSummary, setRecordSummary] = useState({\n    totalRecord: 0,\n    totalLatency: 0,\n    pending: 0,\n    retrying: 0,\n    sent: 0,\n    error: 0\n  });\n  useEffect(() => {\n    if (records) {\n      const recordsSummary = records.reduce((acc, record) => {\n        if (record.type === 'RECORD') {\n          acc.totalLatency += dicoin.getRecordAttemptsLatencyAverage(record);\n          acc.totalRecord += 1;\n          if (record.state === 'PERSISTED') acc.pending += 1;\n          if (record.state === 'SENDING') acc.retrying += 1;\n          if (record.state === 'SENT') acc.sent += 1;\n          if (record.state === 'ERROR') acc.error += 1;\n        }\n\n        return acc;\n      }, {\n        totalRecord: 0,\n        totalLatency: 0,\n        pending: 0,\n        retrying: 0,\n        sent: 0,\n        error: 0\n      });\n      console.log(recordsSummary);\n      setRecordSummary(recordsSummary);\n    }\n  }, [records]);\n  const [tripSummary, setTripSummary] = useState({\n    frontDoorInput: 0,\n    backDoorInput: 0,\n    frontDoorOutput: 0,\n    backDoorOutput: 0,\n    timestamp: 0,\n    endTimestamp: 0,\n    taveledTime: 0\n  });\n  useEffect(() => {\n    if (tripState) {\n      console.log(tripState);\n      const summary = {\n        frontDoorInput: tripState.frontDoorInput,\n        backDoorInput: tripState.backDoorInput,\n        frontDoorOutput: tripState.frontDoorOutput,\n        backDoorOutput: tripState.backDoorOutput,\n        timestamp: tripState.timestamp,\n        endTimestamp: tripState.endTimestamp ? tripState.endTimestamp : 0,\n        taveledTime: tripState.endTimestamp ? tripState.endTimestamp - tripState.timestamp : Date.now() - tripState.timestamp\n      };\n      setTripSummary(summary);\n    }\n  }, [tripState]);\n\n  function msToTime(duration) {\n    const seconds = Math.floor(duration / 1000 % 60);\n    const minutes = Math.floor(duration / (1000 * 60) % 60);\n    const hours = Math.floor(duration / (1000 * 60 * 60) % 24);\n    return `${hours < 9 ? `0${hours}` : hours}:${minutes < 9 ? `0${minutes}` : minutes}:${seconds < 9 ? `0${seconds}` : seconds}`;\n  }\n\n  return /*#__PURE__*/_jsxDEV(Dialog, {\n    open: open,\n    onClose: handleClose,\n    \"aria-labelledby\": \"alert-dialog-title\",\n    \"aria-describedby\": \"alert-dialog-description\",\n    children: [/*#__PURE__*/_jsxDEV(DialogTitle, {\n      id: \"alert-dialog-title\",\n      children: t('TRAVEL_DIALOG_STATISTICS_TITLE')\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(DialogContent, {\n      dividers: true,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-start\",\n        children: [/*#__PURE__*/_jsxDEV(Icon, {\n          className: \"mr-10\",\n          children: \"sync_alt\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(Typography, {\n            children: [recordSummary.sent < 9 ? `0${recordSummary.sent}` : recordSummary.sent, \"/\", recordSummary.totalRecord < 9 ? `0${recordSummary.totalRecord}` : recordSummary.totalRecord, \",\", t('TRAVEL_DIALOG_STATISTICS_PENDING_EVENTS'), \": \", /*#__PURE__*/_jsxDEV(\"b\", {\n              children: recordSummary.pending\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 105,\n              columnNumber: 64\n            }, this), \",\", t('TRAVEL_DIALOG_STATISTICS_RETRANSMISSION_ATTEMPT'), \":\", ' ', /*#__PURE__*/_jsxDEV(\"b\", {\n              children: recordSummary.retrying\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 107,\n              columnNumber: 15\n            }, this), \",\", t('TRAVEL_DIALOG_STATISTICS_TRANSMISSION_ERRORS'), \":\", /*#__PURE__*/_jsxDEV(\"b\", {\n              children: recordSummary.error\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 108,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 100,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Typography, {\n            children: [t('TRAVEL_DIALOG_STATISTICS_TRANSMISSION_LATENCY'), \":\", ' ', /*#__PURE__*/_jsxDEV(\"b\", {\n              children: recordSummary.totalLatency / recordSummary.totalRecord > 0 ? `${parseInt(recordSummary.totalLatency / recordSummary.totalRecord, 10)}milisegundos` : '--'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 112,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 110,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-start mt-10\",\n        children: [/*#__PURE__*/_jsxDEV(Icon, {\n          className: \"mr-10\",\n          children: \"people_alt\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 121,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(Typography, {\n            children: [t('TRAVEL_DIALOG_STATISTICS_INCOME'), \":\", ' ', /*#__PURE__*/_jsxDEV(\"b\", {\n              children: [tripSummary.frontDoorInput + tripSummary.backDoorInput, \", \"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 125,\n              columnNumber: 15\n            }, this), t('TRAVEL_DIALOG_STATISTICS_DEPARTURES'), \":\", ' ', /*#__PURE__*/_jsxDEV(\"b\", {\n              children: tripSummary.frontDoorOutput + tripSummary.backDoorOutput\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 127,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 123,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Typography, {\n            children: [t('TRAVEL_DIALOG_STATISTICS_PASSENGERS_IN_BUS'), \":\", ' ', /*#__PURE__*/_jsxDEV(\"b\", {\n              children: tripSummary.frontDoorInput + tripSummary.backDoorInput - (tripSummary.frontDoorOutput + tripSummary.backDoorOutput)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 131,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 129,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Typography, {\n            children: [t('TRAVEL_DIALOG_STATISTICS_FRONT_DOOR'), \":\", ' ', /*#__PURE__*/_jsxDEV(\"b\", {\n              children: [\"+\", tripSummary.frontDoorInput, \" -\", tripSummary.frontDoorOutput]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 139,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 137,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Typography, {\n            children: [t('TRAVEL_DIALOG_STATISTICS_BACK_DOOR'), \":\", ' ', /*#__PURE__*/_jsxDEV(\"b\", {\n              children: [\"+\", tripSummary.backDoorInput, \" -\", tripSummary.backDoorOutput]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 145,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 143,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-start mt-10\",\n        children: [/*#__PURE__*/_jsxDEV(Icon, {\n          className: \"mr-10\",\n          children: \"access_time\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(Typography, {\n            children: [t('TRAVEL_DIALOG_STATISTICS_LAPSE_OF_TIME'), \":\", ' ', /*#__PURE__*/_jsxDEV(\"b\", {\n              children: [\" \", msToTime(tripSummary.taveledTime)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 156,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 154,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Typography, {\n            children: [t('TRAVEL_DIALOG_STATISTICS_START'), \":\", ' ', /*#__PURE__*/_jsxDEV(\"b\", {\n              children: [\" \", moment(tripSummary.timestamp).format('DD/MM/YYYY HH:mm:ss')]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 160,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 158,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Typography, {\n            children: [t('TRAVEL_DIALOG_STATISTICS_END'), \":\", ' ', /*#__PURE__*/_jsxDEV(\"b\", {\n              children: tripSummary.endTimestamp ? moment(tripSummary.endTimestamp).format('DD/MM/YYYY HH:mm:ss') : '--/--/--- --:--:--'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 164,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 162,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 153,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(DialogActions, {\n      children: /*#__PURE__*/_jsxDEV(Button, {\n        onClick: handleClose,\n        variant: \"contained\",\n        color: \"error\",\n        children: t('TRAVEL_DIALOG_STATISTICS_CLOSE')\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 89,\n    columnNumber: 5\n  }, this);\n}","map":{"version":3,"sources":["/Users/sebastianmolano/NebulaE/Projects/GTPC/dicon-audit-pwa/frontend/dicon-audit-pwa/src/app/main/travels/dialogs/DialogStatistics.js"],"names":["useState","useEffect","useContext","moment","useTranslation","Button","Dialog","DialogActions","DialogContent","DialogTitle","Typography","Icon","makeStyles","TravelContext","useStyles","DialogStatistics","props","open","handleClose","t","classes","records","tripState","dicoin","recordSummary","setRecordSummary","totalRecord","totalLatency","pending","retrying","sent","error","recordsSummary","reduce","acc","record","type","getRecordAttemptsLatencyAverage","state","console","log","tripSummary","setTripSummary","frontDoorInput","backDoorInput","frontDoorOutput","backDoorOutput","timestamp","endTimestamp","taveledTime","summary","Date","now","msToTime","duration","seconds","Math","floor","minutes","hours","parseInt","format"],"mappings":"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","sourcesContent":["import { useState, useEffect, useContext } from 'react';\n\nimport moment from 'moment';\nimport { useTranslation } from 'react-i18next';\n\nimport {\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  Typography,\n  Icon,\n} from '@mui/material';\nimport { makeStyles } from '@mui/styles';\nimport TravelContext from '../travel-context/TravelContext';\n\nconst useStyles = makeStyles({});\n\nexport default function DialogStatistics(props) {\n  const { open, handleClose } = props;\n  const { t } = useTranslation('travelsPage');\n  const classes = useStyles();\n  const { records, tripState, dicoin } = useContext(TravelContext);\n  const [recordSummary, setRecordSummary] = useState({\n    totalRecord: 0,\n    totalLatency: 0,\n    pending: 0,\n    retrying: 0,\n    sent: 0,\n    error: 0,\n  });\n  useEffect(() => {\n    if (records) {\n      const recordsSummary = records.reduce(\n        (acc, record) => {\n          if (record.type === 'RECORD') {\n            acc.totalLatency += dicoin.getRecordAttemptsLatencyAverage(record);\n            acc.totalRecord += 1;\n            if (record.state === 'PERSISTED') acc.pending += 1;\n            if (record.state === 'SENDING') acc.retrying += 1;\n            if (record.state === 'SENT') acc.sent += 1;\n            if (record.state === 'ERROR') acc.error += 1;\n          }\n          return acc;\n        },\n        { totalRecord: 0, totalLatency: 0, pending: 0, retrying: 0, sent: 0, error: 0 }\n      );\n      console.log(recordsSummary);\n      setRecordSummary(recordsSummary);\n    }\n  }, [records]);\n  const [tripSummary, setTripSummary] = useState({\n    frontDoorInput: 0,\n    backDoorInput: 0,\n    frontDoorOutput: 0,\n    backDoorOutput: 0,\n    timestamp: 0,\n    endTimestamp: 0,\n    taveledTime: 0,\n  });\n  useEffect(() => {\n    if (tripState) {\n      console.log(tripState);\n      const summary = {\n        frontDoorInput: tripState.frontDoorInput,\n        backDoorInput: tripState.backDoorInput,\n        frontDoorOutput: tripState.frontDoorOutput,\n        backDoorOutput: tripState.backDoorOutput,\n        timestamp: tripState.timestamp,\n        endTimestamp: tripState.endTimestamp ? tripState.endTimestamp : 0,\n        taveledTime: tripState.endTimestamp\n          ? tripState.endTimestamp - tripState.timestamp\n          : Date.now() - tripState.timestamp,\n      };\n      setTripSummary(summary);\n    }\n  }, [tripState]);\n  function msToTime(duration) {\n    const seconds = Math.floor((duration / 1000) % 60);\n    const minutes = Math.floor((duration / (1000 * 60)) % 60);\n    const hours = Math.floor((duration / (1000 * 60 * 60)) % 24);\n\n    return `${hours < 9 ? `0${hours}` : hours}:${minutes < 9 ? `0${minutes}` : minutes}:${\n      seconds < 9 ? `0${seconds}` : seconds\n    }`;\n  }\n  return (\n    <Dialog\n      open={open}\n      onClose={handleClose}\n      aria-labelledby=\"alert-dialog-title\"\n      aria-describedby=\"alert-dialog-description\"\n    >\n      <DialogTitle id=\"alert-dialog-title\">{t('TRAVEL_DIALOG_STATISTICS_TITLE')}</DialogTitle>\n      <DialogContent dividers>\n        <div className=\"flex items-start\">\n          <Icon className=\"mr-10\">sync_alt</Icon>\n          <div>\n            <Typography>\n              {recordSummary.sent < 9 ? `0${recordSummary.sent}` : recordSummary.sent}/\n              {recordSummary.totalRecord < 9\n                ? `0${recordSummary.totalRecord}`\n                : recordSummary.totalRecord}\n              ,{t('TRAVEL_DIALOG_STATISTICS_PENDING_EVENTS')}: <b>{recordSummary.pending}</b>,\n              {t('TRAVEL_DIALOG_STATISTICS_RETRANSMISSION_ATTEMPT')}:{' '}\n              <b>{recordSummary.retrying}</b>,{t('TRAVEL_DIALOG_STATISTICS_TRANSMISSION_ERRORS')}:\n              <b>{recordSummary.error}</b>\n            </Typography>\n            <Typography>\n              {t('TRAVEL_DIALOG_STATISTICS_TRANSMISSION_LATENCY')}:{' '}\n              <b>\n                {recordSummary.totalLatency / recordSummary.totalRecord > 0\n                  ? `${parseInt(recordSummary.totalLatency / recordSummary.totalRecord, 10)}milisegundos`\n                  : '--'}\n              </b>\n            </Typography>\n          </div>\n        </div>\n        <div className=\"flex items-start mt-10\">\n          <Icon className=\"mr-10\">people_alt</Icon>\n          <div>\n            <Typography>\n              {t('TRAVEL_DIALOG_STATISTICS_INCOME')}:{' '}\n              <b>{tripSummary.frontDoorInput + tripSummary.backDoorInput}, </b>\n              {t('TRAVEL_DIALOG_STATISTICS_DEPARTURES')}:{' '}\n              <b>{tripSummary.frontDoorOutput + tripSummary.backDoorOutput}</b>\n            </Typography>\n            <Typography>\n              {t('TRAVEL_DIALOG_STATISTICS_PASSENGERS_IN_BUS')}:{' '}\n              <b>\n                {tripSummary.frontDoorInput +\n                  tripSummary.backDoorInput -\n                  (tripSummary.frontDoorOutput + tripSummary.backDoorOutput)}\n              </b>\n            </Typography>\n            <Typography>\n              {t('TRAVEL_DIALOG_STATISTICS_FRONT_DOOR')}:{' '}\n              <b>\n                +{tripSummary.frontDoorInput} -{tripSummary.frontDoorOutput}\n              </b>\n            </Typography>\n            <Typography>\n              {t('TRAVEL_DIALOG_STATISTICS_BACK_DOOR')}:{' '}\n              <b>\n                +{tripSummary.backDoorInput} -{tripSummary.backDoorOutput}\n              </b>\n            </Typography>\n          </div>\n        </div>\n        <div className=\"flex items-start mt-10\">\n          <Icon className=\"mr-10\">access_time</Icon>\n          <div>\n            <Typography>\n              {t('TRAVEL_DIALOG_STATISTICS_LAPSE_OF_TIME')}:{' '}\n              <b> {msToTime(tripSummary.taveledTime)}</b>\n            </Typography>\n            <Typography>\n              {t('TRAVEL_DIALOG_STATISTICS_START')}:{' '}\n              <b> {moment(tripSummary.timestamp).format('DD/MM/YYYY HH:mm:ss')}</b>\n            </Typography>\n            <Typography>\n              {t('TRAVEL_DIALOG_STATISTICS_END')}:{' '}\n              <b>\n                {tripSummary.endTimestamp\n                  ? moment(tripSummary.endTimestamp).format('DD/MM/YYYY HH:mm:ss')\n                  : '--/--/--- --:--:--'}\n              </b>\n            </Typography>\n          </div>\n        </div>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={handleClose} variant=\"contained\" color=\"error\">\n          {t('TRAVEL_DIALOG_STATISTICS_CLOSE')}\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}