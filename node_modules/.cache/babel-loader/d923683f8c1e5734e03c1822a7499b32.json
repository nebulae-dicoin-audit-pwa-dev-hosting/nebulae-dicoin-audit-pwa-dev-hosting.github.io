{"ast":null,"code":"import _slicedToArray from\"/Users/sebastianmolano/NebulaE/Projects/GTPC/dicon-audit-pwa/frontend/dicon-audit-pwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useEffect,useRef,useState}from'react';import _ from'@lodash';import useNavigatorPermissions from'./NavigatorPermissions';var dopScale={Ideal:{min:0,max:0.9},Excellent:{min:1,max:2},Good:{min:3,max:5},Moderate:{min:6,max:10},Fair:{min:11,max:20},Poor:{min:21,max:21}};var useGeolocation=function useGeolocation(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},enableHighAccuracy=_ref.enableHighAccuracy,maximumAge=_ref.maximumAge,timeout=_ref.timeout;var callback=arguments.length>1?arguments[1]:undefined;var _useState=useState({coords:{accuracy:null,altitude:null,altitudeAccuracy:null,heading:null,latitude:null,longitude:null,speed:null},timestamp:null,error:null}),_useState2=_slicedToArray(_useState,2),coordinates=_useState2[0],setCoordinates=_useState2[1];var watchId=useRef();var _useNavigatorPermissi=useNavigatorPermissions('geolocation'),status=_useNavigatorPermissi.status,error=_useNavigatorPermissi.error;function generateDop(accuracy,_ref2,_ref3){var minAccuaracy=_ref2.min,maxAccuaracy=_ref2.max;var minDop=_ref3.min,maxDop=_ref3.max;/*\n    porcentaje dentro del rango de precisiÃ³n =  (7-3)/(10-3) = 0.57142857142\n    porcentaje del rango DOP = (2-1)*0.57142857142+1 = 1.57142857142\n    DOP con redondeo = 1.6\n    */var accuaracyPercentage=(accuracy-minAccuaracy)/(maxAccuaracy-minAccuaracy);var dopPercentage=(maxDop-minDop)*accuaracyPercentage+minDop;return Math.round(dopPercentage*10)/10;}function convertAccuracyToDop(accuracy){if(accuracy>=0&&accuracy<3)return generateDop(accuracy,{min:0,max:3},dopScale.Ideal);if(accuracy>=3&&accuracy<10)return generateDop(accuracy,{min:3,max:10},dopScale.Excellent);if(accuracy>=10&&accuracy<50)return generateDop(accuracy,{min:10,max:50},dopScale.Good);if(accuracy>=50&&accuracy<100)return generateDop(accuracy,{min:50,max:100},dopScale.Moderate);// if (accuracy >= 100 && accuracy < 300)\n//   return generateDop(accuracy, { min: 100, max: 300 }, dopScale.Fare);\n// if (accuracy >= 300) return generateDop(accuracy, { min: 300, max: 9999 }, dopScale.Poor);\nreturn 10.9;}useEffect(function(){var didCancel;var updateCoordinates=function updateCoordinates(_ref4){var _ref4$coords=_ref4.coords,coords=_ref4$coords===void 0?{}:_ref4$coords,timestamp=_ref4.timestamp;var latitude=coords.latitude,longitude=coords.longitude,speed=coords.speed,accuracy=coords.accuracy;var coorLat=coordinates.latitude,coorLon=coordinates.longitude,coorSpeed=coordinates.speed;if(!didCancel){if(!_.isEqual({latitude:coorLat,longitude:coorLon,speed:coorSpeed},{latitude:latitude,longitude:longitude,speed:speed})){setCoordinates({coords:{latitude:latitude,longitude:longitude,accuracy:accuracy,dop:convertAccuracyToDop(accuracy),speed:parseInt(speed,10)||0},timestamp:timestamp,error:null});}if(callback instanceof Function){callback({coords:{latitude:latitude,longitude:longitude,speed:parseInt(speed,10)||0},timestamp:timestamp,error:null});}}};var setError=function setError(error){if(!didCancel){watchId.current=null;setCoordinates({coords:{latitude:null,longitude:null,accuracy:null,dop:null,speed:0},timestamp:null,error:error});}};if(status!=='granted'){if(watchId.current){navigator.geolocation.clearWatch(watchId.current);watchId.current=null;}navigator.geolocation.getCurrentPosition(updateCoordinates,setError,{enableHighAccuracy:enableHighAccuracy,maximumAge:maximumAge,timeout:timeout});}else if(navigator.geolocation&&!watchId.current){watchId.current=navigator.geolocation.watchPosition(updateCoordinates,setError,{enableHighAccuracy:enableHighAccuracy,maximumAge:maximumAge,timeout:timeout});}return function(){if(watchId.current){navigator.geolocation.clearWatch(watchId.current);}didCancel=true;};},[navigator.geolocation,status]);return coordinates;};export default useGeolocation;","map":null,"metadata":{},"sourceType":"module"}