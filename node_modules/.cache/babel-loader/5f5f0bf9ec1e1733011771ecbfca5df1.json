{"ast":null,"code":"\"use strict\";\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spread = this && this.__spread || function () {\n  for (var ar = [], i = 0; i < arguments.length; i++) {\n    ar = ar.concat(__read(arguments[i]));\n  }\n\n  return ar;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar diff = require(\"diff\");\n\nvar jsDiff = diff;\nvar DiffType;\n\n(function (DiffType) {\n  DiffType[DiffType[\"DEFAULT\"] = 0] = \"DEFAULT\";\n  DiffType[DiffType[\"ADDED\"] = 1] = \"ADDED\";\n  DiffType[DiffType[\"REMOVED\"] = 2] = \"REMOVED\";\n})(DiffType = exports.DiffType || (exports.DiffType = {})); // See https://github.com/kpdecker/jsdiff/tree/v4.0.1#api for more info on the below JsDiff methods\n\n\nvar DiffMethod;\n\n(function (DiffMethod) {\n  DiffMethod[\"CHARS\"] = \"diffChars\";\n  DiffMethod[\"WORDS\"] = \"diffWords\";\n  DiffMethod[\"WORDS_WITH_SPACE\"] = \"diffWordsWithSpace\";\n  DiffMethod[\"LINES\"] = \"diffLines\";\n  DiffMethod[\"TRIMMED_LINES\"] = \"diffTrimmedLines\";\n  DiffMethod[\"SENTENCES\"] = \"diffSentences\";\n  DiffMethod[\"CSS\"] = \"diffCss\";\n})(DiffMethod = exports.DiffMethod || (exports.DiffMethod = {}));\n/**\n * Splits diff text by new line and computes final list of diff lines based on\n * conditions.\n *\n * @param value Diff text from the js diff module.\n */\n\n\nvar constructLines = function constructLines(value) {\n  var lines = value.split('\\n');\n  var isAllEmpty = lines.every(function (val) {\n    return !val;\n  });\n\n  if (isAllEmpty) {\n    // This is to avoid added an extra new line in the UI.\n    if (lines.length === 2) {\n      return [];\n    }\n\n    lines.pop();\n    return lines;\n  }\n\n  var lastLine = lines[lines.length - 1];\n  var firstLine = lines[0]; // Remove the first and last element if they are new line character. This is\n  // to avoid addition of extra new line in the UI.\n\n  if (!lastLine) {\n    lines.pop();\n  }\n\n  if (!firstLine) {\n    lines.shift();\n  }\n\n  return lines;\n};\n/**\n * Computes word diff information in the line.\n * [TODO]: Consider adding options argument for JsDiff text block comparison\n *\n * @param oldValue Old word in the line.\n * @param newValue New word in the line.\n * @param compareMethod JsDiff text diff method from https://github.com/kpdecker/jsdiff/tree/v4.0.1#api\n */\n\n\nvar computeDiff = function computeDiff(oldValue, newValue, compareMethod) {\n  if (compareMethod === void 0) {\n    compareMethod = DiffMethod.CHARS;\n  }\n\n  var diffArray = jsDiff[compareMethod](oldValue, newValue);\n  var computedDiff = {\n    left: [],\n    right: []\n  };\n  diffArray.forEach(function (_a) {\n    var added = _a.added,\n        removed = _a.removed,\n        value = _a.value;\n    var diffInformation = {};\n\n    if (added) {\n      diffInformation.type = DiffType.ADDED;\n      diffInformation.value = value;\n      computedDiff.right.push(diffInformation);\n    }\n\n    if (removed) {\n      diffInformation.type = DiffType.REMOVED;\n      diffInformation.value = value;\n      computedDiff.left.push(diffInformation);\n    }\n\n    if (!removed && !added) {\n      diffInformation.type = DiffType.DEFAULT;\n      diffInformation.value = value;\n      computedDiff.right.push(diffInformation);\n      computedDiff.left.push(diffInformation);\n    }\n\n    return diffInformation;\n  });\n  return computedDiff;\n};\n/**\n * [TODO]: Think about moving common left and right value assignment to a\n * common place. Better readability?\n *\n * Computes line wise information based in the js diff information passed. Each\n * line contains information about left and right section. Left side denotes\n * deletion and right side denotes addition.\n *\n * @param oldString Old string to compare.\n * @param newString New string to compare with old string.\n * @param disableWordDiff Flag to enable/disable word diff.\n * @param compareMethod JsDiff text diff method from https://github.com/kpdecker/jsdiff/tree/v4.0.1#api\n * @param linesOffset line number to start counting from\n */\n\n\nvar computeLineInformation = function computeLineInformation(oldString, newString, disableWordDiff, compareMethod, linesOffset) {\n  if (disableWordDiff === void 0) {\n    disableWordDiff = false;\n  }\n\n  if (compareMethod === void 0) {\n    compareMethod = DiffMethod.CHARS;\n  }\n\n  if (linesOffset === void 0) {\n    linesOffset = 0;\n  }\n\n  var diffArray = diff.diffLines(oldString.trimRight(), newString.trimRight(), {\n    newlineIsToken: true,\n    ignoreWhitespace: false,\n    ignoreCase: false\n  });\n  var rightLineNumber = linesOffset;\n  var leftLineNumber = linesOffset;\n  var lineInformation = [];\n  var counter = 0;\n  var diffLines = [];\n  var ignoreDiffIndexes = [];\n\n  var getLineInformation = function getLineInformation(value, diffIndex, added, removed, evaluateOnlyFirstLine) {\n    var lines = constructLines(value);\n    return lines.map(function (line, lineIndex) {\n      var left = {};\n      var right = {};\n\n      if (ignoreDiffIndexes.includes(diffIndex + \"-\" + lineIndex) || evaluateOnlyFirstLine && lineIndex !== 0) {\n        return undefined;\n      }\n\n      if (added || removed) {\n        if (!diffLines.includes(counter)) {\n          diffLines.push(counter);\n        }\n\n        if (removed) {\n          leftLineNumber += 1;\n          left.lineNumber = leftLineNumber;\n          left.type = DiffType.REMOVED;\n          left.value = line || ' '; // When the current line is of type REMOVED, check the next item in\n          // the diff array whether it is of type ADDED. If true, the current\n          // diff will be marked as both REMOVED and ADDED. Meaning, the\n          // current line is a modification.\n\n          var nextDiff = diffArray[diffIndex + 1];\n\n          if (nextDiff && nextDiff.added) {\n            var nextDiffLines = constructLines(nextDiff.value)[lineIndex];\n\n            if (nextDiffLines) {\n              var _a = getLineInformation(nextDiff.value, diffIndex, true, false, true)[0].right,\n                  rightValue = _a.value,\n                  lineNumber = _a.lineNumber,\n                  type = _a.type; // When identified as modification, push the next diff to ignore\n              // list as the next value will be added in this line computation as\n              // right and left values.\n\n              ignoreDiffIndexes.push(diffIndex + 1 + \"-\" + lineIndex);\n              right.lineNumber = lineNumber;\n              right.type = type; // Do word level diff and assign the corresponding values to the\n              // left and right diff information object.\n\n              if (disableWordDiff) {\n                right.value = rightValue;\n              } else {\n                var computedDiff = computeDiff(line, rightValue, compareMethod);\n                right.value = computedDiff.right;\n                left.value = computedDiff.left;\n              }\n            }\n          }\n        } else {\n          rightLineNumber += 1;\n          right.lineNumber = rightLineNumber;\n          right.type = DiffType.ADDED;\n          right.value = line;\n        }\n      } else {\n        leftLineNumber += 1;\n        rightLineNumber += 1;\n        left.lineNumber = leftLineNumber;\n        left.type = DiffType.DEFAULT;\n        left.value = line;\n        right.lineNumber = rightLineNumber;\n        right.type = DiffType.DEFAULT;\n        right.value = line;\n      }\n\n      counter += 1;\n      return {\n        right: right,\n        left: left\n      };\n    }).filter(Boolean);\n  };\n\n  diffArray.forEach(function (_a, index) {\n    var added = _a.added,\n        removed = _a.removed,\n        value = _a.value;\n    lineInformation = __spread(lineInformation, getLineInformation(value, index, added, removed));\n  });\n  return {\n    lineInformation: lineInformation,\n    diffLines: diffLines\n  };\n};\n\nexports.computeLineInformation = computeLineInformation;","map":null,"metadata":{},"sourceType":"script"}