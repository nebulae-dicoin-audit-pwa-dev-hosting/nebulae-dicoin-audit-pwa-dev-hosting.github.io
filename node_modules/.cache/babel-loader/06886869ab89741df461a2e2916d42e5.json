{"ast":null,"code":"import _createForOfIteratorHelper from\"/Users/sebastianmolano/NebulaE/Projects/GTPC/dicon-audit-pwa/frontend/dicon-audit-pwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _slicedToArray from\"/Users/sebastianmolano/NebulaE/Projects/GTPC/dicon-audit-pwa/frontend/dicon-audit-pwa/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";/* REACT CORE */import React,{useState,useEffect}from'react';/* UI CORE - MATERIAL-UI */ /* MAP UI core */import GoogleMap from'google-map-react';/* @FUSE COMPONENTS */import{mapOptions}from'./mapOptions';import Marker from'./Marker';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export function Map(props){var pathAppFile=props.pathAppFile,pathAuthorityFile=props.pathAuthorityFile,setMapChangedTimestamp=props.setMapChangedTimestamp,authorityAppFileContent=props.authorityAppFileContent,mappedTable=props.mappedTable;var _useState=useState(),_useState2=_slicedToArray(_useState,2),appFilePolyline=_useState2[0],setAppFilePolyline=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),authorityFilePolyline=_useState4[0],setAthorityFilePolyline=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),authEvents=_useState6[0],setAuthEvents=_useState6[1];var apiIsLoaded=function apiIsLoaded(map,maps){var appFilePolylineMap=new maps.Polyline({path:pathAppFile,geodesic:false,strokeColor:'#7B2AD7',strokeOpacity:1,strokeWeight:3});var authorityPolyline=new maps.Polyline({path:pathAuthorityFile,geodesic:false,strokeColor:'#2d7fe2',strokeOpacity:1,strokeWeight:3});appFilePolylineMap.setMap(map);setAppFilePolyline(appFilePolylineMap);authorityPolyline.setMap(map);setAthorityFilePolyline(authorityPolyline);};useEffect(function(){setMapChangedTimestamp(Date.now());},[appFilePolyline,authorityFilePolyline]);useEffect(function(){var currentAuthContent=[];if(authorityAppFileContent){var _iterator=_createForOfIteratorHelper(authorityAppFileContent),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var authRow=_step.value;var _iterator2=_createForOfIteratorHelper(authRow.eventos),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var event=_step2.value;var formattedEvent=formatEventData(event);currentAuthContent.push(formattedEvent);}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}}}catch(err){_iterator.e(err);}finally{_iterator.f();}}currentAuthContent.sort(function(a,b){return b.timestamp-a.timestamp;});console.log('currentAuthContent',authorityAppFileContent);setAuthEvents(currentAuthContent);},[authorityAppFileContent]);var formatEventData=function formatEventData(event){var eventFormatted={};var year=event.fecha.slice(0,4);var month=event.fecha.slice(4,6);var day=event.fecha.slice(6,8);var hour=event.hora.slice(0,2);var minute=event.hora.slice(2,4);var second=event.hora.slice(4,6);var timestamp=new Date(\"\".concat(year,\"-\").concat(month,\"-\").concat(day,\"T\").concat(hour,\":\").concat(minute,\":\").concat(second,\"-05:00\")).getTime();var backDoor=event.puerta.find(function(_ref){var idPuerta=_ref.idPuerta;return idPuerta===1;});var frontDoor=event.puerta.find(function(_ref2){var idPuerta=_ref2.idPuerta;return idPuerta===0;});eventFormatted.backDoor=backDoor;eventFormatted.frontDoor=frontDoor;eventFormatted.timestamp=timestamp;eventFormatted.dop=parseFloat(event.dop.replace(',','.'));eventFormatted.longitude=parseFloat(event.longitud.replace(',','.'));eventFormatted.latitude=parseFloat(event.latitud.replace(',','.'));return eventFormatted;};var getRecordToDraw=function getRecordToDraw(event,index,events){var prevRecord=events[index-1]||{};var _prevRecord$frontDoor=prevRecord.frontDoor,prevFrontDoor=_prevRecord$frontDoor===void 0?{}:_prevRecord$frontDoor,_prevRecord$backDoor=prevRecord.backDoor,prevBackDoor=_prevRecord$backDoor===void 0?{}:_prevRecord$backDoor;var frontDoor=event.frontDoor,backDoor=event.backDoor;var hasPassengerFlow=(frontDoor.ingresos||0)!==0||(frontDoor.salidas||0)!==0||(backDoor.ingresos||0)!==0||(backDoor.salidas||0)!==0;var hasDoorChange=prevRecord?prevFrontDoor.estado!==frontDoor.estado||prevBackDoor.estado!==backDoor.estado:false;return hasPassengerFlow||hasDoorChange;};var buildMarker=function buildMarker(type,eventData,index){var frontDoor=eventData.frontDoor,backDoor=eventData.backDoor,latitude=eventData.latitude,longitude=eventData.longitude,timestamp=eventData.timestamp;var frontDoorInput=frontDoor.ingresos,frontDoorOutput=frontDoor.salidas,frontDoorOpen=frontDoor.estado;var backDoorInput=backDoor.ingresos,backDoorOutput=backDoor.salidas,backDoorOpen=backDoor.estado;var contentText=\"\".concat(type,\": \").concat(!frontDoorOpen?'DA':'DC',\"+\").concat(frontDoorInput,\"-\").concat(frontDoorOutput,\", \").concat(!backDoorOpen?'TA':'TC',\"+\").concat(backDoorInput,\"-\").concat(backDoorOutput);return/*#__PURE__*/_jsx(Marker,{lat:latitude,lng:longitude,type:type,text:contentText},\"\".concat(index,\"-\").concat(type));};return/*#__PURE__*/_jsx(\"div\",{id:\"listing_parent\",className:\"w-full h-full\",children:/*#__PURE__*/_jsxs(GoogleMap,{bootstrapURLKeys:{key:process.env.REACT_APP_MAP_KEY},options:mapOptions,defaultZoom:12,defaultCenter:[6.236118,-75.580598],yesIWantToUseGoogleMapApiInternals:true,onGoogleApiLoaded:function onGoogleApiLoaded(_ref3){var map=_ref3.map,maps=_ref3.maps;return apiIsLoaded(map,maps);},children:[mappedTable.map(function(m,index){var _m$coordinates=m.coordinates,latitude=_m$coordinates.latitude,longitude=_m$coordinates.longitude,dateTime=m.dateTime,bdpentr=m.bdpentr,fdpentr=m.fdpentr,bdpexit=m.bdpexit,fdpexit=m.fdpexit,doorState=m.doorState,dop=m.dop,flag=m.flag;var contentText=\"\".concat(index+1,\". \").concat(dateTime,\", Puerta:\").concat(doorState,\", Ingresos:\").concat(fdpentr,\"/\").concat(bdpentr,\", Salido:\").concat(fdpexit,\"/\").concat(bdpexit,\", DOP:\").concat(dop);return/*#__PURE__*/_jsx(Marker,{lat:latitude,lng:longitude,type:'APP',flag:flag,text:contentText},\"\".concat(index,\"-APP\"));}),authEvents.filter(function(event,index,events){return getRecordToDraw(event,index,events);}).map(function(event,index){return buildMarker('AUTH',event,index);})]})});}function mapPropsAreEqual(prevProps,nextProps){return prevProps.mapChangedTimestamp===nextProps.mapChangedTimestamp;}var MemoizedMap=/*#__PURE__*/React.memo(Map,mapPropsAreEqual);export default MemoizedMap;","map":null,"metadata":{},"sourceType":"module"}